###############################################################################
#                                                                             #
# IAR 8051 C/C++ Compiler V7.30B/W32                    26/May/2011  13:14:40 #
# Copyright 2004-2007 IAR Systems. All rights reserved.                       #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data                                               #
#    Dptr setup         =  1,16                                               #
#    Source file        =  D:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\z #
#                          stack\Samples\GenericApp\Source\GenericApp.c       #
#    Command line       =  -f "D:\Texas Instruments\ZStack-1.4.3-1.2.1\Projec #
#                          ts\zstack\Samples\GenericApp\CC2430DB\..\..\..\Too #
#                          ls\CC2430DB\f8wCoord.cfg" (-DCPU32MHZ              #
#                          -DFORCE_MAC_NEAR -DROOT=__near_func                #
#                          -DMAC_CFG_APP_PENDING_QUEUE=TRUE                   #
#                          -DZDO_COORDINATOR -DRTR_NWK -DBLINK_LEDS           #
#                          "-DCONST=const __code" -DGENERIC=__generic) -f     #
#                          "D:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\ #
#                          zstack\Samples\GenericApp\CC2430DB\..\..\..\Tools\ #
#                          CC2430DB\f8wConfig.cfg" (-DSECURE=0                #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFFF                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=10 -DAPSC_MAX_FRAME_RETRIES=3   #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=20           #
#                          -DNWK_MAX_BINDING_ENTRIES=10                       #
#                          -DMAX_BINDING_CLUSTER_IDS=5 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000        #
#                          -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100)   #
#                          -DREJOIN_POLL_RATE=440 "D:\Texas                   #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\GenericApp\Source\GenericApp.c" -D CC2430EB   #
#                          -D REFLECTOR -D ZTOOL_P1 -D MT_TASK -D             #
#                          xMT_ZDO_FUNC -D LCD_SUPPORTED=DEBUG -lC "D:\Texas  #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\GenericApp\CC2430DB\CoordinatorEB\List\" -lA  #
#                          "D:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\ #
#                          zstack\Samples\GenericApp\CC2430DB\CoordinatorEB\L #
#                          ist\" --diag_suppress Pe001,Pa010 --diag_remark    #
#                          pe550 -o "D:\Texas Instruments\ZStack-1.4.3-1.2.1\ #
#                          Projects\zstack\Samples\GenericApp\CC2430DB\Coordi #
#                          natorEB\Obj\" -e -z9 --no_code_motion --debug      #
#                          --core=plain --dptr=16,1 --data_model=large        #
#                          --code_model=banked --calling_convention=xdata_ree #
#                          ntrant --place_constants=data --nr_virtual_regs 8  #
#                          -I "D:\Texas Instruments\ZStack-1.4.3-1.2.1\Projec #
#                          ts\zstack\Samples\GenericApp\CC2430DB\" -I         #
#                          "D:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\ #
#                          zstack\Samples\GenericApp\CC2430DB\..\SOURCE\" -I  #
#                          "D:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\ #
#                          zstack\Samples\GenericApp\CC2430DB\..\..\..\ZMAIN\ #
#                          TI2430DB\" -I "D:\Texas Instruments\ZStack-1.4.3-1 #
#                          .2.1\Projects\zstack\Samples\GenericApp\CC2430DB\. #
#                          .\..\..\..\..\COMPONENTS\MT\" -I "D:\Texas         #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\GenericApp\CC2430DB\..\..\..\..\..\COMPONENTS #
#                          \HAL\INCLUDE\" -I "D:\Texas                        #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\GenericApp\CC2430DB\..\..\..\..\..\COMPONENTS #
#                          \HAL\TARGET\CC2430EB\" -I "D:\Texas                #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\GenericApp\CC2430DB\..\..\..\..\..\COMPONENTS #
#                          \OSAL\MCU\CCSOC\" -I "D:\Texas                     #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\GenericApp\CC2430DB\..\..\..\..\..\COMPONENTS #
#                          \OSAL\INCLUDE\" -I "D:\Texas                       #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\GenericApp\CC2430DB\..\..\..\..\..\COMPONENTS #
#                          \STACK\AF\" -I "D:\Texas                           #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\GenericApp\CC2430DB\..\..\..\..\..\COMPONENTS #
#                          \STACK\NWK\" -I "D:\Texas                          #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\GenericApp\CC2430DB\..\..\..\..\..\COMPONENTS #
#                          \STACK\SEC\" -I "D:\Texas                          #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\GenericApp\CC2430DB\..\..\..\..\..\COMPONENTS #
#                          \STACK\SYS\" -I "D:\Texas                          #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\GenericApp\CC2430DB\..\..\..\..\..\COMPONENTS #
#                          \STACK\ZDO\" -I "D:\Texas                          #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\GenericApp\CC2430DB\..\..\..\..\..\COMPONENTS #
#                          \ZMAC\F8W\" -I "D:\Texas                           #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\GenericApp\CC2430DB\..\..\..\..\..\COMPONENTS #
#                          \ZMAC\" -I "D:\Texas Instruments\ZStack-1.4.3-1.2. #
#                          1\Projects\zstack\Samples\GenericApp\CC2430DB\..\. #
#                          .\..\..\..\COMPONENTS\SERVICES\SADDR\" -I          #
#                          "D:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\ #
#                          zstack\Samples\GenericApp\CC2430DB\..\..\..\..\..\ #
#                          COMPONENTS\SERVICES\SDATA\" -I "D:\Texas           #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\GenericApp\CC2430DB\..\..\..\..\..\COMPONENTS #
#                          \MAC\INCLUDE\" -I "D:\Texas                        #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\GenericApp\CC2430DB\..\..\..\..\..\COMPONENTS #
#                          \MAC\HIGH_LEVEL\" -I "D:\Texas                     #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\GenericApp\CC2430DB\..\..\..\..\..\COMPONENTS #
#                          \MAC\LOW_LEVEL\SRF03\" -I "D:\Texas                #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\GenericApp\CC2430DB\..\..\..\..\..\COMPONENTS #
#                          \MAC\LOW_LEVEL\SRF03\SINGLE_CHIP\" -I "D:\Program  #
#                          Files\IAR Systems\Embedded Workbench 4.0           #
#                          Evaluation version\8051\INC\" -I "D:\Program       #
#                          Files\IAR Systems\Embedded Workbench 4.0           #
#                          Evaluation version\8051\INC\CLIB\"                 #
#    List file          =  D:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\z #
#                          stack\Samples\GenericApp\CC2430DB\CoordinatorEB\Li #
#                          st\GenericApp.lst                                  #
#    Object file        =  D:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\z #
#                          stack\Samples\GenericApp\CC2430DB\CoordinatorEB\Ob #
#                          j\GenericApp.r51                                   #
#                                                                             #
#                                                                             #
###############################################################################

D:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Samples\GenericApp\Source\GenericApp.c
      1          /**************************************************************************************************
      2            Filename:       GenericApp.c
      3            Revised:        $Date: 2007-10-27 17:16:54 -0700 (Sat, 27 Oct 2007) $
      4            Revision:       $Revision: 15793 $
      5          
      6            Description:    Generic Application (no Profile).
      7          
      8          
      9            Copyright 2004-2007 Texas Instruments Incorporated. All rights reserved.
     10          
     11            IMPORTANT: Your use of this Software is limited to those specific rights
     12            granted under the terms of a software license agreement between the user
     13            who downloaded the software, his/her employer (which must be your employer)
     14            and Texas Instruments Incorporated (the "License").  You may not use this
     15            Software unless you agree to abide by the terms of the License. The License
     16            limits your use, and you acknowledge, that the Software may not be modified,
     17            copied or distributed unless embedded on a Texas Instruments microcontroller
     18            or used solely and exclusively in conjunction with a Texas Instruments radio
     19            frequency transceiver, which is integrated into your product.  Other than for
     20            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     21            works of, modify, distribute, perform, display or sell this Software and/or
     22            its documentation for any purpose.
     23          
     24            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     25            PROVIDED “AS IS?WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED, 
     26            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE, 
     27            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     28            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     29            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     30            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     31            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     32            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     33            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     34            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     35          
     36            Should you have any questions regarding your right to use this Software,
     37            contact Texas Instruments Incorporated at www.TI.com. 
     38          **************************************************************************************************/
     39          
     40          /*********************************************************************
     41            This application isn't intended to do anything useful, it is
     42            intended to be a simple example of an application's structure.
     43          
     44            This application sends "Hello World" to another "Generic"
     45            application every 15 seconds.  The application will also
     46            receive "Hello World" packets.
     47          
     48            The "Hello World" messages are sent/received as MSG type message.
     49          
     50            This applications doesn't have a profile, so it handles everything
     51            directly - itself.
     52          
     53            Key control:
     54              SW1:
     55              SW2:  initiates end device binding
     56              SW3:
     57              SW4:  initiates a match description request
     58          *********************************************************************/
     59          
     60          /*********************************************************************
     61           * INCLUDES
     62           */
     63          #include "OSAL.h"
     64          #include "AF.h"
     65          #include "ZDApp.h"
     66          #include "ZDObject.h"
     67          #include "ZDProfile.h"
     68          
     69          #include "GenericApp.h"
     70          #include "DebugTrace.h"
     71          
     72          #if !defined( WIN32 )
     73            #include "OnBoard.h"

   \                                 In  segment SFR_AN, at 0x86
   \   unsigned char volatile __sfr U0CSR
   \                     U0CSR:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0x88
   \   union <unnamed> volatile __sfr _A_TCON
   \                     _A_TCON:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xa8
   \   union <unnamed> volatile __sfr _A_IEN0
   \                     _A_IEN0:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xc1
   \   unsigned char volatile __sfr U0DBUF
   \                     U0DBUF:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xc2
   \   unsigned char volatile __sfr U0BAUD
   \                     U0BAUD:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xc4
   \   unsigned char volatile __sfr U0UCR
   \                     U0UCR:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xc5
   \   unsigned char volatile __sfr U0GCR
   \                     U0GCR:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xc6
   \   unsigned char volatile __sfr CLKCON
   \                     CLKCON:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xe8
   \   union <unnamed> volatile __sfr _A_IRCON2
   \                     _A_IRCON2:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xf1
   \   unsigned char volatile __sfr PERCFG
   \                     PERCFG:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xf3
   \   unsigned char volatile __sfr P0SEL
   \                     P0SEL:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xf4
   \   unsigned char volatile __sfr P1SEL
   \                     P1SEL:
   \   000000                DS 1
     74          #endif
     75          
     76          /* HAL */
     77          #include "hal_lcd.h"
     78          #include "hal_led.h"
     79          #include "hal_key.h"
     80          #include "hal_uart.h"
     81          #include "uart0.h"
     82          
     83          //xiaoyang add 
     84          #include <string.h>
     85          #include <stdio.h>
     86          #include "SPIMgr.h"
     87          //#include <stdlib.h>
     88          /*********************************************************************
     89           * MACROS
     90           */
     91          /*********************************************************************
     92           * MACROS
     93           */
     94          //xiaoyang add
     95          /* See the important comment by the otaBuf declaration below concerning the
     96           * mandatory use of this macro vice directly invoking osal_mem_free().
     97           */
     98          #define FREE_OTABUF() { \
     99            if ( otaBuf ) \
    100            { \
    101              osal_mem_free( otaBuf ); \
    102            } \
    103            if ( otaBuf2 ) \
    104            { \
    105              SerialApp_SendData( otaBuf2, otaLen2 ); \
    106              otaBuf2 = NULL; \
    107            } \
    108            else \
    109            { \
    110              otaBuf = NULL; \
    111            } \
    112          }
    113          
    114          /*********************************************************************
    115           * CONSTANTS
    116           */
    117          
    118          #if !defined( SERIAL_APP_PORT )
    119            #define SERIAL_APP_PORT  1
    120          #endif
    121          
    122          #if !defined( SERIAL_APP_BAUD )
    123            // CC2430 only allows 38.4k or 115.2k.
    124            #define SERIAL_APP_BAUD  HAL_UART_BR_38400
    125            //#define SERIAL_APP_BAUD  HAL_UART_BR_115200
    126          #endif
    127          
    128          // When the Rx buf space is less than this threshold, invoke the Rx callback.
    129          #if !defined( SERIAL_APP_THRESH )
    130            #define SERIAL_APP_THRESH  48
    131          #endif
    132          
    133          #if !defined( SERIAL_APP_RX_MAX )
    134            #if (defined( HAL_UART_DMA )) && HAL_UART_DMA
    135              #define SERIAL_APP_RX_MAX  128
    136            #else
    137              /* The generic safe Rx minimum is 48, but if you know your PC App will not
    138               * continue to send more than a byte after receiving the ~CTS, lower max
    139               * here and safe min in _hal_uart.c to just 8.
    140               */
    141              #define SERIAL_APP_RX_MAX  64
    142            #endif
    143          #endif
    144          
    145          #if !defined( SERIAL_APP_TX_MAX )
    146            #if (defined( HAL_UART_DMA )) && HAL_UART_DMA
    147            #define SERIAL_APP_TX_MAX  128
    148            #else
    149              #define SERIAL_APP_TX_MAX  64
    150            #endif
    151          #endif
    152          
    153          // Millisecs of idle time after a byte is received before invoking Rx callback.
    154          #if !defined( SERIAL_APP_IDLE )
    155            #define SERIAL_APP_IDLE  6
    156          #endif
    157          
    158          // This is the desired byte count per OTA message.
    159          #if !defined( SERIAL_APP_RX_CNT )
    160            #if (defined( HAL_UART_DMA )) && HAL_UART_DMA
    161              #define SERIAL_APP_RX_CNT  80
    162            #else
    163              #define SERIAL_APP_RX_CNT  6
    164            #endif
    165          #endif
    166          
    167          // Loopback Rx bytes to Tx for thruput testing.
    168          #if !defined( SERIAL_APP_LOOPBACK )
    169            #define SERIAL_APP_LOOPBACK  FALSE
    170          #endif
    171          
    172          #if SERIAL_APP_LOOPBACK
    173            #define SERIALAPP_TX_RTRY_EVT      0x0010
    174            #define SERIALAPP_TX_RTRY_TIMEOUT  250
    175          #endif
    176          
    177          /*********************************************************************
    178           * CONSTANTS
    179           */
    180          
    181          /*********************************************************************
    182           * TYPEDEFS
    183           */
    184          
    185          /*********************************************************************
    186           * DEBUG
    187           */
    188          #define _m_debug    1
    189          
    190          /*********************************************************************
    191           * GLOBAL VARIABLES
    192           */
    193          
    194          // This list should be filled with Application specific Cluster IDs.

   \                                 In  segment XDATA_I, align 1, keep-with-next
    195          const cId_t GenericApp_ClusterList[GENERICAPP_MAX_CLUSTERS] =
   \                     GenericApp_ClusterList:
   \   000000                DS 2
   \   000002                REQUIRE `?<Initializer for GenericApp_ClusterList>`
   \   000002                REQUIRE __INIT_XDATA_I
    196          {
    197            GENERICAPP_CLUSTERID
    198          };
    199          

   \                                 In  segment XDATA_I, align 1, keep-with-next
    200          const SimpleDescriptionFormat_t GenericApp_SimpleDesc =
   \                     GenericApp_SimpleDesc:
   \   000000                DS 12
   \   00000C                REQUIRE `?<Initializer for GenericApp_SimpleDesc>`
   \   00000C                REQUIRE __INIT_XDATA_I
    201          {
    202            GENERICAPP_ENDPOINT,              //  int Endpoint;
    203            GENERICAPP_PROFID,                //  uint16 AppProfId[2];
    204            GENERICAPP_DEVICEID,              //  uint16 AppDeviceId[2];
    205            GENERICAPP_DEVICE_VERSION,        //  int   AppDevVer:4;
    206            GENERICAPP_FLAGS,                 //  int   AppFlags:4;
    207            GENERICAPP_MAX_CLUSTERS,          //  byte  AppNumInClusters;
    208            (cId_t *)GenericApp_ClusterList,  //  byte *pAppInClusterList;
    209            GENERICAPP_MAX_CLUSTERS,          //  byte  AppNumInClusters;
    210            (cId_t *)GenericApp_ClusterList   //  byte *pAppInClusterList;
    211          };
    212          
    213          // This is the Endpoint/Interface description.  It is defined here, but
    214          // filled-in in GenericApp_Init().  Another way to go would be to fill
    215          // in the structure here and make it a "const" (in code space).  The
    216          // way it's defined in this sample app it is define in RAM.

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    217          endPointDesc_t GenericApp_epDesc;
   \                     GenericApp_epDesc:
   \   000000                DS 6
   \   000006                REQUIRE __INIT_XDATA_Z
    218          
    219          /*********************************************************************
    220           * EXTERNAL VARIABLES
    221           */
    222          
    223          /*********************************************************************
    224           * EXTERNAL FUNCTIONS
    225           */
    226          
    227          /*********************************************************************
    228           * LOCAL VARIABLES
    229           */

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    230          byte GenericApp_TaskID;   // Task ID for internal task/event processing
   \                     GenericApp_TaskID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    231                                    // This variable will be received when
    232                                    // GenericApp_Init() is called.

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    233          devStates_t GenericApp_NwkState;
   \                     GenericApp_NwkState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    234          
    235          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    236          byte GenericApp_TransID;  // This is the unique message ID (counter)
   \                     GenericApp_TransID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    237          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    238          afAddrType_t GenericApp_DstAddr;
   \                     GenericApp_DstAddr:
   \   000000                DS 4
   \   000004                REQUIRE __INIT_XDATA_Z
    239          
    240          
    241          //------------------------------------------------------------------------------
    242          //xiaoyang add, data_trans task
    243          //------------------------------------------------------------------------------

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    244          byte data_trans_TaskID;
   \                     data_trans_TaskID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    245          
    246          
    247          /*********************************************************************
    248           * LOCAL FUNCTIONS
    249           */
    250          void GenericApp_ProcessZDOMsgs( zdoIncomingMsg_t *inMsg );
    251          void GenericApp_HandleKeys( byte shift, byte keys );
    252          void GenericApp_MessageMSGCB( afIncomingMSGPacket_t *pckt );
    253          void GenericApp_SendTheMessage( void );
    254          
    255          /*********************************************************************
    256           * NETWORK LAYER CALLBACKS
    257           */
    258          
    259          /*********************************************************************
    260           * PUBLIC FUNCTIONS
    261           */
    262          
    263          /*********************************************************************
    264           * @fn      GenericApp_Init
    265           *
    266           * @brief   Initialization function for the Generic App Task.
    267           *          This is called during initialization and should contain
    268           *          any application specific initialization (ie. hardware
    269           *          initialization/setup, table initialization, power up
    270           *          notificaiton ... ).
    271           *
    272           * @param   task_id - the ID assigned by OSAL.  This ID should be
    273           *                    used to send messages and set timers.
    274           *
    275           * @return  none
    276           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    277          void GenericApp_Init( byte task_id )
   \                     GenericApp_Init:
    278          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    279            GenericApp_TaskID = task_id;
   \   000004   E9           MOV     A,R1
   \   000005   90....       MOV     DPTR,#GenericApp_TaskID
   \   000008   F0           MOVX    @DPTR,A
    280            GenericApp_NwkState = DEV_INIT;
   \   000009   7401         MOV     A,#0x1
   \   00000B   90....       MOV     DPTR,#GenericApp_NwkState
   \   00000E   F0           MOVX    @DPTR,A
    281            GenericApp_TransID = 0;
   \   00000F   E4           CLR     A
   \   000010   90....       MOV     DPTR,#GenericApp_TransID
   \   000013   F0           MOVX    @DPTR,A
    282            //xiaoyang add
    283            halUARTCfg_t uartConfig;
                                ^
Warning[Pe177]: variable "uartConfig" was declared but never referenced
    284            // Device hardware initialization can be added here or in main() (Zmain.c).
    285            // If the hardware is application specific - add it here.
    286            // If the hardware is other parts of the device add it in main().
    287          
    288            GenericApp_DstAddr.addrMode = (afAddrMode_t)AddrNotPresent;
   \   000014   90....       MOV     DPTR,#(GenericApp_DstAddr + 2)
   \   000017   F0           MOVX    @DPTR,A
    289            GenericApp_DstAddr.endPoint = 0;
   \   000018   90....       MOV     DPTR,#(GenericApp_DstAddr + 3)
   \   00001B   F0           MOVX    @DPTR,A
    290            GenericApp_DstAddr.addr.shortAddr = 0;
   \   00001C   90....       MOV     DPTR,#GenericApp_DstAddr
   \   00001F   F0           MOVX    @DPTR,A
   \   000020   A3           INC     DPTR
   \   000021   F0           MOVX    @DPTR,A
    291          
    292            // Fill out the endpoint description.
    293            GenericApp_epDesc.endPoint = GENERICAPP_ENDPOINT;
   \   000022   740A         MOV     A,#0xa
   \   000024   90....       MOV     DPTR,#GenericApp_epDesc
   \   000027   F0           MOVX    @DPTR,A
    294            GenericApp_epDesc.task_id = &GenericApp_TaskID;
   \   000028   90....       MOV     DPTR,#(GenericApp_epDesc + 1)
   \   00002B   74..         MOV     A,#(GenericApp_TaskID & 0xff)
   \   00002D   F0           MOVX    @DPTR,A
   \   00002E   A3           INC     DPTR
   \   00002F   74..         MOV     A,#((GenericApp_TaskID >> 8) & 0xff)
   \   000031   F0           MOVX    @DPTR,A
    295            GenericApp_epDesc.simpleDesc
    296                      = (SimpleDescriptionFormat_t *)&GenericApp_SimpleDesc;
   \   000032   90....       MOV     DPTR,#(GenericApp_epDesc + 3)
   \   000035   74..         MOV     A,#(GenericApp_SimpleDesc & 0xff)
   \   000037   F0           MOVX    @DPTR,A
   \   000038   A3           INC     DPTR
   \   000039   74..         MOV     A,#((GenericApp_SimpleDesc >> 8) & 0xff)
   \   00003B   F0           MOVX    @DPTR,A
    297            GenericApp_epDesc.latencyReq = noLatencyReqs;
   \   00003C   E4           CLR     A
   \   00003D   90....       MOV     DPTR,#(GenericApp_epDesc + 5)
   \   000040   F0           MOVX    @DPTR,A
    298          
    299            // Register the endpoint description with the AF
    300            afRegister( &GenericApp_epDesc );
   \   000041                ; Setup parameters for call to function afRegister
   \   000041   7A..         MOV     R2,#(GenericApp_epDesc & 0xff)
   \   000043   7B..         MOV     R3,#((GenericApp_epDesc >> 8) & 0xff)
   \   000045   12....       LCALL   ??afRegister?relay
    301          
    302            // Register for all key events - This app will handle all key events
    303            RegisterForKeys( GenericApp_TaskID );
   \   000048                ; Setup parameters for call to function RegisterForKeys
   \   000048   90....       MOV     DPTR,#GenericApp_TaskID
   \   00004B   E0           MOVX    A,@DPTR
   \   00004C   F9           MOV     R1,A
   \   00004D   12....       LCALL   ??RegisterForKeys?relay
    304          
    305            // Update the display
    306          #if defined ( LCD_SUPPORTED )
    307              HalLcdWriteString( "GenericApp", HAL_LCD_LINE_1 );
   \   000050                ; Setup parameters for call to function HalLcdWriteString
   \   000050   7900         MOV     R1,#0x0
   \   000052   7A..         MOV     R2,#(`?<Constant "GenericApp">` & 0xff)
   \   000054   7B..         MOV     R3,#((`?<Constant "GenericApp">` >> 8) & 0xff)
   \   000056   12....       LCALL   ??HalLcdWriteString?relay
    308          #endif
    309              /*
    310            //xiaoyang add
    311            uartConfig.configured           = TRUE;              // 2430 don't care.
    312            uartConfig.baudRate             = SERIAL_APP_BAUD;
    313            uartConfig.flowControl          = TRUE;
    314            uartConfig.flowControlThreshold = SERIAL_APP_THRESH;
    315            uartConfig.rx.maxBufSize        = SERIAL_APP_RX_MAX;
    316            uartConfig.tx.maxBufSize        = SERIAL_APP_TX_MAX;
    317            uartConfig.idleTimeout          = SERIAL_APP_IDLE;   // 2430 don't care.
    318            uartConfig.intEnable            = TRUE;              // 2430 don't care.
    319          #if SERIAL_APP_LOOPBACK
    320            uartConfig.callBackFunc         = NULL;
    321          #else
    322            uartConfig.callBackFunc         = NULL;
    323          #endif
    324            HalUARTOpen (SERIAL_APP_PORT, &uartConfig);
    325            */
    326            //
    327            ZDO_RegisterForZDOMsg( GenericApp_TaskID, End_Device_Bind_rsp );
   \   000059                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000059   7A20         MOV     R2,#0x20
   \   00005B   7B80         MOV     R3,#-0x80
   \   00005D   90....       MOV     DPTR,#GenericApp_TaskID
   \   000060   E0           MOVX    A,@DPTR
   \   000061   F9           MOV     R1,A
   \   000062   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay
    328            ZDO_RegisterForZDOMsg( GenericApp_TaskID, Match_Desc_rsp );
   \   000065                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000065   7A06         MOV     R2,#0x6
   \   000067   7B80         MOV     R3,#-0x80
   \   000069   90....       MOV     DPTR,#GenericApp_TaskID
   \   00006C   E0           MOVX    A,@DPTR
   \   00006D   F9           MOV     R1,A
   \   00006E   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay
    329            
    330            //xiaoyang ADD@2011.5.26
    331            initUART();
   \   000071                ; Setup parameters for call to function initUART
   \   000071   12....       LCALL   ??initUART?relay
    332          }
   \   000074                REQUIRE ?Subroutine4
   \   000074                ; // Fall through to label ?Subroutine4

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine4:
   \   000000   D083         POP     DPH
   \   000002   D082         POP     DPL
   \   000004   02....       LJMP    ?BRET
    333          
    334          /*********************************************************************
    335           * @fn      GenericApp_ProcessEvent
    336           *
    337           * @brief   Generic Application Task event processor.  This function
    338           *          is called to process all events for the task.  Events
    339           *          include timers, messages and any other user defined events.
    340           *
    341           * @param   task_id  - The OSAL assigned task ID.
    342           * @param   events - events to process.  This is a bit map and can
    343           *                   contain more than one event.
    344           *
    345           * @return  none
    346           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    347          UINT16 GenericApp_ProcessEvent( byte task_id, UINT16 events )
   \                     GenericApp_ProcessEvent:
    348          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    349            afIncomingMSGPacket_t *MSGpkt;
    350            afDataConfirm_t *afDataConfirm;
    351          
    352            // Data Confirmation message fields
    353            byte sentEP;
    354            ZStatus_t sentStatus;
    355            byte sentTransID;       // This should match the value sent
    356          
    357            if ( events & SYS_EVENT_MSG )
   \   000009   7480         MOV     A,#-0x80
   \   00000B   5F           ANL     A,R7
   \   00000C   F9           MOV     R1,A
   \   00000D   E4           CLR     A
   \   00000E   7001         JNZ     ??GenericApp_ProcessEvent_0
   \   000010   E9           MOV     A,R1
   \                     ??GenericApp_ProcessEvent_0:
   \   000011   7003         JNZ     $+5
   \   000013   02....       LJMP    ??GenericApp_ProcessEvent_1 & 0xFFFF
    358            {
    359              MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( GenericApp_TaskID );
   \   000016                ; Setup parameters for call to function osal_msg_receive
   \   000016   8031         SJMP    ??GenericApp_ProcessEvent_2
    360              while ( MSGpkt )
    361              {
    362                switch ( MSGpkt->hdr.event )
    363                {
    364                  case ZDO_CB_MSG:
    365                    GenericApp_ProcessZDOMsgs( (zdoIncomingMsg_t *)MSGpkt );
    366                    break;
    367          
    368                  case KEY_CHANGE:
    369                    GenericApp_HandleKeys( ((keyChange_t *)MSGpkt)->state, ((keyChange_t *)MSGpkt)->keys );
    370                    break;
    371          
    372                  case AF_DATA_CONFIRM_CMD:
    373                    // This message is received as a confirmation of a data packet sent.
    374                    // The status is of ZStatus_t type [defined in ZComDef.h]
    375                    // The message fields are defined in AF.h
    376                    afDataConfirm = (afDataConfirm_t *)MSGpkt;
    377                    sentEP = afDataConfirm->endpoint;
    378                    sentStatus = afDataConfirm->hdr.status;
    379                    sentTransID = afDataConfirm->transID;
    380                    (void)sentEP;
    381                    (void)sentTransID;
    382          
    383                    // Action taken when confirmation is received.
    384                    if ( sentStatus != ZSuccess )
    385                    {
    386                      // The data wasn't delivered -- Do something
    387                    }
    388                    break;
    389          
    390                  case AF_INCOMING_MSG_CMD:
    391                    GenericApp_MessageMSGCB( MSGpkt );
    392                    break;
    393          
    394                  case ZDO_STATE_CHANGE:
    395                    GenericApp_NwkState = (devStates_t)(MSGpkt->hdr.status);
   \                     ??GenericApp_ProcessEvent_3:
   \   000018   85..82       MOV     DPL,?V0 + 0
   \   00001B   85..83       MOV     DPH,?V0 + 1
   \   00001E   A3           INC     DPTR
   \   00001F   E0           MOVX    A,@DPTR
   \   000020   90....       MOV     DPTR,#GenericApp_NwkState
   \   000023   F0           MOVX    @DPTR,A
    396                    if ( (GenericApp_NwkState == DEV_ZB_COORD)
    397                        || (GenericApp_NwkState == DEV_ROUTER)
    398                        || (GenericApp_NwkState == DEV_END_DEVICE) )
   \   000024   6409         XRL     A,#0x9
   \   000026   600A         JZ      ??GenericApp_ProcessEvent_4
   \   000028   E0           MOVX    A,@DPTR
   \   000029   6407         XRL     A,#0x7
   \   00002B   6005         JZ      ??GenericApp_ProcessEvent_4
   \   00002D   E0           MOVX    A,@DPTR
   \   00002E   6406         XRL     A,#0x6
   \   000030   7010         JNZ     ??GenericApp_ProcessEvent_5
    399                    {
    400                      // Start sending "the" message in a regular interval.
    401                      osal_start_timerEx( GenericApp_TaskID,
    402                                          GENERICAPP_SEND_MSG_EVT,
    403                                          GENERICAPP_SEND_MSG_TIMEOUT );
   \                     ??GenericApp_ProcessEvent_4:
   \   000032                ; Setup parameters for call to function osal_start_timerEx
   \   000032   7C88         MOV     R4,#-0x78
   \   000034   7D13         MOV     R5,#0x13
   \   000036   7A01         MOV     R2,#0x1
   \   000038   7B00         MOV     R3,#0x0
   \   00003A   90....       MOV     DPTR,#GenericApp_TaskID
   \   00003D   E0           MOVX    A,@DPTR
   \   00003E   F9           MOV     R1,A
   \   00003F   12....       LCALL   ??osal_start_timerEx?relay
    404                    }
    405                    break;
    406          
    407                  default:
    408                    break;
    409                }
    410          
    411                // Release the memory
    412                osal_msg_deallocate( (uint8 *)MSGpkt );
   \                     ??GenericApp_ProcessEvent_5:
   \   000042                ; Setup parameters for call to function osal_msg_deallocate
   \   000042   AA..         MOV     R2,?V0 + 0
   \   000044   AB..         MOV     R3,?V0 + 1
   \   000046   12....       LCALL   ??osal_msg_deallocate?relay
    413          
    414                // Next
    415                MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( GenericApp_TaskID );
   \   000049                ; Setup parameters for call to function osal_msg_receive
   \                     ??GenericApp_ProcessEvent_2:
   \   000049   90....       MOV     DPTR,#GenericApp_TaskID
   \   00004C   E0           MOVX    A,@DPTR
   \   00004D   F9           MOV     R1,A
   \   00004E   12....       LCALL   ??osal_msg_receive?relay
   \   000051   8A..         MOV     ?V0 + 0,R2
   \   000053   8B..         MOV     ?V0 + 1,R3
   \   000055   E5..         MOV     A,?V0 + 0
   \   000057   7002         JNZ     ??GenericApp_ProcessEvent_6
   \   000059   E5..         MOV     A,?V0 + 1
   \                     ??GenericApp_ProcessEvent_6:
   \   00005B   6046         JZ      ??GenericApp_ProcessEvent_7
   \   00005D   85..82       MOV     DPL,?V0 + 0
   \   000060   85..83       MOV     DPH,?V0 + 1
   \   000063   E0           MOVX    A,@DPTR
   \   000064   12....       LCALL   ?UC_SWITCH_SPARSE
   \                     `?<Jumptable for GenericApp_ProcessEvent>_0`:
   \   000067   00           DB        0
   \   000068   04           DB        4
   \   000069   1A           DB        26
   \   00006A   ....         DW        ??GenericApp_ProcessEvent_8
   \   00006C   C0           DB        192
   \   00006D   ....         DW        ??GenericApp_ProcessEvent_9
   \   00006F   D1           DB        209
   \   000070   ....         DW        ??GenericApp_ProcessEvent_3
   \   000072   D3           DB        211
   \   000073   ....         DW        ??GenericApp_ProcessEvent_10
   \   000075   ....         DW        ??GenericApp_ProcessEvent_5
   \                     ??GenericApp_ProcessEvent_10:
   \   000077                ; Setup parameters for call to function GenericApp_ProcessZDOMsgs
   \   000077   AA..         MOV     R2,?V0 + 0
   \   000079   AB..         MOV     R3,?V0 + 1
   \   00007B   12....       LCALL   ??GenericApp_ProcessZDOMsgs?relay
   \   00007E   80C2         SJMP    ??GenericApp_ProcessEvent_5
   \                     ??GenericApp_ProcessEvent_9:
   \   000080                ; Setup parameters for call to function GenericApp_HandleKeys
   \   000080   85..82       MOV     DPL,?V0 + 0
   \   000083   85..83       MOV     DPH,?V0 + 1
   \   000086   A3           INC     DPTR
   \   000087   A3           INC     DPTR
   \   000088   A3           INC     DPTR
   \   000089   E0           MOVX    A,@DPTR
   \   00008A   FA           MOV     R2,A
   \   00008B   85..82       MOV     DPL,?V0 + 0
   \   00008E   85..83       MOV     DPH,?V0 + 1
   \   000091   A3           INC     DPTR
   \   000092   A3           INC     DPTR
   \   000093   E0           MOVX    A,@DPTR
   \   000094   F9           MOV     R1,A
   \   000095   12....       LCALL   ??GenericApp_HandleKeys?relay
   \   000098   80A8         SJMP    ??GenericApp_ProcessEvent_5
   \                     ??GenericApp_ProcessEvent_8:
   \   00009A                ; Setup parameters for call to function GenericApp_MessageMSGCB
   \   00009A   AA..         MOV     R2,?V0 + 0
   \   00009C   AB..         MOV     R3,?V0 + 1
   \   00009E   12....       LCALL   ??GenericApp_MessageMSGCB?relay
   \   0000A1   809F         SJMP    ??GenericApp_ProcessEvent_5
    416              }
    417          
    418              // return unprocessed events
    419              return (events ^ SYS_EVENT_MSG);
   \                     ??GenericApp_ProcessEvent_7:
   \   0000A3   EE           MOV     A,R6
   \   0000A4   FA           MOV     R2,A
   \   0000A5   7480         MOV     A,#-0x80
   \   0000A7   6F           XRL     A,R7
   \                     ??GenericApp_ProcessEvent_11:
   \   0000A8   FB           MOV     R3,A
   \   0000A9   8023         SJMP    ??GenericApp_ProcessEvent_12
    420            }
    421          
    422            // Send a message out - This event is generated by a timer
    423            //  (setup in GenericApp_Init()).
    424            if ( events & GENERICAPP_SEND_MSG_EVT )
   \                     ??GenericApp_ProcessEvent_1:
   \   0000AB   EE           MOV     A,R6
   \   0000AC   A2E0         MOV     C,0xE0 /* A   */.0
   \   0000AE   501A         JNC     ??GenericApp_ProcessEvent_13
    425            {
    426              // Send "the" message
    427              GenericApp_SendTheMessage();
   \   0000B0                ; Setup parameters for call to function GenericApp_SendTheMessage
   \   0000B0   12....       LCALL   ??GenericApp_SendTheMessage?relay
    428          
    429              // Setup to send message again
    430              osal_start_timerEx( GenericApp_TaskID,
    431                                  GENERICAPP_SEND_MSG_EVT,
    432                                  GENERICAPP_SEND_MSG_TIMEOUT );
   \   0000B3                ; Setup parameters for call to function osal_start_timerEx
   \   0000B3   7C88         MOV     R4,#-0x78
   \   0000B5   7D13         MOV     R5,#0x13
   \   0000B7   7A01         MOV     R2,#0x1
   \   0000B9   7B00         MOV     R3,#0x0
   \   0000BB   90....       MOV     DPTR,#GenericApp_TaskID
   \   0000BE   E0           MOVX    A,@DPTR
   \   0000BF   F9           MOV     R1,A
   \   0000C0   12....       LCALL   ??osal_start_timerEx?relay
    433          
    434              // return unprocessed events
    435              return (events ^ GENERICAPP_SEND_MSG_EVT);
   \   0000C3   7401         MOV     A,#0x1
   \   0000C5   6E           XRL     A,R6
   \   0000C6   FA           MOV     R2,A
   \   0000C7   EF           MOV     A,R7
   \   0000C8   80DE         SJMP    ??GenericApp_ProcessEvent_11
    436            }
    437          
    438            // Discard unknown events
    439            return 0;
   \                     ??GenericApp_ProcessEvent_13:
   \   0000CA   7A00         MOV     R2,#0x0
   \   0000CC   7B00         MOV     R3,#0x0
   \                     ??GenericApp_ProcessEvent_12:
   \   0000CE                REQUIRE ?Subroutine5
   \   0000CE                ; // Fall through to label ?Subroutine5
    440          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine5:
   \   000000   7F04         MOV     R7,#0x4
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA
    441          
    442          /*********************************************************************
    443           * Event Generation Functions
    444           */
    445          /*********************************************************************
    446           * @fn      GenericApp_ProcessZDOMsgs()
    447           *
    448           * @brief   Process response messages
    449           *
    450           * @param   none
    451           *
    452           * @return  none
    453           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    454          void GenericApp_ProcessZDOMsgs( zdoIncomingMsg_t *inMsg )
   \                     GenericApp_ProcessZDOMsgs:
    455          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
    456            switch ( inMsg->clusterID )
   \   000005   EA           MOV     A,R2
   \   000006   240C         ADD     A,#0xc
   \   000008   F582         MOV     DPL,A
   \   00000A   EB           MOV     A,R3
   \   00000B   3400         ADDC    A,#0x0
   \   00000D   F583         MOV     DPH,A
   \   00000F   12....       LCALL   ?Subroutine1 & 0xFFFF
   \                     ??CrossCallReturnLabel_2:
   \   000012   12....       LCALL   ?US_SWITCH_SPARSE
   \                     `?<Jumptable for GenericApp_ProcessZDOMsgs>_0`:
   \   000015   0000         DW        0
   \   000017   0200         DW        2
   \   000019   0680         DW        32774
   \   00001B   ....         DW        ??GenericApp_ProcessZDOMsgs_0
   \   00001D   2080         DW        32800
   \   00001F   ....         DW        ??GenericApp_ProcessZDOMsgs_1
   \   000021   ....         DW        ??GenericApp_ProcessZDOMsgs_2
    457            {
    458              case End_Device_Bind_rsp:
    459                if ( ZDO_ParseBindRsp( inMsg ) == ZSuccess )
   \                     ??GenericApp_ProcessZDOMsgs_1:
   \   000023   EA           MOV     A,R2
   \   000024   2411         ADD     A,#0x11
   \   000026   F582         MOV     DPL,A
   \   000028   EB           MOV     A,R3
   \   000029   3400         ADDC    A,#0x0
   \   00002B   F583         MOV     DPH,A
   \   00002D   E0           MOVX    A,@DPTR
   \   00002E   F8           MOV     R0,A
   \   00002F   A3           INC     DPTR
   \   000030   E0           MOVX    A,@DPTR
   \   000031   F583         MOV     DPH,A
   \   000033   8882         MOV     DPL,R0
   \   000035   E0           MOVX    A,@DPTR
   \   000036   7009         JNZ     ??GenericApp_ProcessZDOMsgs_3
    460                {
    461                  // Light LED
    462                  HalLedSet( HAL_LED_4, HAL_LED_MODE_ON );
   \   000038                ; Setup parameters for call to function HalLedSet
   \   000038   7A01         MOV     R2,#0x1
   \                     ??GenericApp_ProcessZDOMsgs_4:
   \   00003A   7908         MOV     R1,#0x8
   \   00003C   12....       LCALL   ??HalLedSet?relay
   \   00003F   8055         SJMP    ??GenericApp_ProcessZDOMsgs_2
    463                }
    464          #if defined(BLINK_LEDS)
    465                else
    466                {
    467                  // Flash LED to show failure
    468                  HalLedSet ( HAL_LED_4, HAL_LED_MODE_FLASH );
   \                     ??GenericApp_ProcessZDOMsgs_3:
   \   000041                ; Setup parameters for call to function HalLedSet
   \   000041   7A04         MOV     R2,#0x4
   \   000043   80F5         SJMP    ??GenericApp_ProcessZDOMsgs_4
    469                }
    470          #endif
    471                break;
    472          
    473              case Match_Desc_rsp:
    474                {
    475                  ZDO_ActiveEndpointRsp_t *pRsp = ZDO_ParseEPListRsp( inMsg );
   \                     ??GenericApp_ProcessZDOMsgs_0:
   \   000045                ; Setup parameters for call to function ZDO_ParseEPListRsp
   \   000045   12....       LCALL   ??ZDO_ParseEPListRsp?relay
   \   000048   8A..         MOV     ?V0 + 0,R2
   \   00004A   8B..         MOV     ?V0 + 1,R3
   \   00004C   AE..         MOV     R6,?V0 + 0
   \   00004E   AF..         MOV     R7,?V0 + 1
    476                  if ( pRsp )
   \   000050   EE           MOV     A,R6
   \   000051   7001         JNZ     ??GenericApp_ProcessZDOMsgs_5
   \   000053   EF           MOV     A,R7
   \                     ??GenericApp_ProcessZDOMsgs_5:
   \   000054   6040         JZ      ??GenericApp_ProcessZDOMsgs_2
    477                  {
    478                    if ( pRsp->status == ZSuccess && pRsp->cnt )
   \   000056   8E82         MOV     DPL,R6
   \   000058   8F83         MOV     DPH,R7
   \   00005A   E0           MOVX    A,@DPTR
   \   00005B   7032         JNZ     ??GenericApp_ProcessZDOMsgs_6
   \   00005D   A3           INC     DPTR
   \   00005E   A3           INC     DPTR
   \   00005F   A3           INC     DPTR
   \   000060   E0           MOVX    A,@DPTR
   \   000061   602C         JZ      ??GenericApp_ProcessZDOMsgs_6
    479                    {
    480                      GenericApp_DstAddr.addrMode = (afAddrMode_t)Addr16Bit;
   \   000063   7402         MOV     A,#0x2
   \   000065   90....       MOV     DPTR,#(GenericApp_DstAddr + 2)
   \   000068   F0           MOVX    @DPTR,A
    481                      GenericApp_DstAddr.addr.shortAddr = pRsp->nwkAddr;
   \   000069   8E82         MOV     DPL,R6
   \   00006B   8F83         MOV     DPH,R7
   \   00006D   A3           INC     DPTR
   \   00006E   E0           MOVX    A,@DPTR
   \   00006F   F8           MOV     R0,A
   \   000070   A3           INC     DPTR
   \   000071   E0           MOVX    A,@DPTR
   \   000072   F9           MOV     R1,A
   \   000073   90....       MOV     DPTR,#GenericApp_DstAddr
   \   000076   E8           MOV     A,R0
   \   000077   F0           MOVX    @DPTR,A
   \   000078   A3           INC     DPTR
   \   000079   E9           MOV     A,R1
   \   00007A   F0           MOVX    @DPTR,A
    482                      // Take the first endpoint, Can be changed to search through endpoints
    483                      GenericApp_DstAddr.endPoint = pRsp->epList[0];
   \   00007B   8E82         MOV     DPL,R6
   \   00007D   8F83         MOV     DPH,R7
   \   00007F   A3           INC     DPTR
   \   000080   A3           INC     DPTR
   \   000081   A3           INC     DPTR
   \   000082   A3           INC     DPTR
   \   000083   E0           MOVX    A,@DPTR
   \   000084   90....       MOV     DPTR,#(GenericApp_DstAddr + 3)
   \   000087   F0           MOVX    @DPTR,A
    484          
    485                      // Light LED
    486                      HalLedSet( HAL_LED_4, HAL_LED_MODE_ON );
   \   000088                ; Setup parameters for call to function HalLedSet
   \   000088   7A01         MOV     R2,#0x1
   \   00008A   7908         MOV     R1,#0x8
   \   00008C   12....       LCALL   ??HalLedSet?relay
    487                    }
    488                    osal_mem_free( pRsp );
   \                     ??GenericApp_ProcessZDOMsgs_6:
   \   00008F                ; Setup parameters for call to function osal_mem_free
   \   00008F   EE           MOV     A,R6
   \   000090   FA           MOV     R2,A
   \   000091   EF           MOV     A,R7
   \   000092   FB           MOV     R3,A
   \   000093   12....       LCALL   ??osal_mem_free?relay
    489                  }
    490                }
    491                break;
    492            }
    493          }
   \                     ??GenericApp_ProcessZDOMsgs_2:
   \   000096   80..         SJMP    ??Subroutine6_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine6:
   \   000000   12....       LCALL   ?DEALLOC_XSTACK8
   \                     ??Subroutine6_0:
   \   000003   7F02         MOV     R7,#0x2
   \   000005   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   E0           MOVX    A,@DPTR
   \   000001   F5..         MOV     ?V0 + 0,A
   \   000003   A3           INC     DPTR
   \   000004   E0           MOVX    A,@DPTR
   \   000005   F5..         MOV     ?V0 + 1,A
   \   000007   78..         MOV     R0,#?V0 + 0
   \   000009   22           RET
    494          
    495          /*********************************************************************
    496           * @fn      GenericApp_HandleKeys
    497           *
    498           * @brief   Handles all key events for this device.
    499           *
    500           * @param   shift - true if in shift/alt.
    501           * @param   keys - bit field for key events. Valid entries:
    502           *                 HAL_KEY_SW_4
    503           *                 HAL_KEY_SW_3
    504           *                 HAL_KEY_SW_2
    505           *                 HAL_KEY_SW_1
    506           *
    507           * @return  none
    508           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    509          void GenericApp_HandleKeys( byte shift, byte keys )
   \                     GenericApp_HandleKeys:
    510          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 9
   \   000005   74F7         MOV     A,#-0x9
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
    511            zAddrType_t dstAddr;
    512          
    513            // Shift is used to make each button/switch dual purpose.
    514            if ( shift )
   \   00000C   E9           MOV     A,R1
   \   00000D   6003         JZ      $+5
   \   00000F   02....       LJMP    ??GenericApp_HandleKeys_0 & 0xFFFF
    515            {
    516              if ( keys & HAL_KEY_SW_1 )
    517              {
    518              }
    519              if ( keys & HAL_KEY_SW_2 )
    520              {
    521              }
    522              if ( keys & HAL_KEY_SW_3 )
    523              {
    524              }
    525              if ( keys & HAL_KEY_SW_4 )
    526              {
    527              }
    528            }
    529            else
    530            {
    531              if ( keys & HAL_KEY_SW_1 )
   \   000012   EE           MOV     A,R6
   \   000013   A2E0         MOV     C,0xE0 /* A   */.0
   \   000015   500B         JNC     ??GenericApp_HandleKeys_1
    532              {
    533          #if _m_debug
    534                uart0_puts("hal sw1 pressed!\r\n",strlen("hal sw1 pressed!\r\n"));
   \   000017                ; Setup parameters for call to function uart0_puts
   \   000017   7C12         MOV     R4,#0x12
   \   000019   7D00         MOV     R5,#0x0
   \   00001B   7A..         MOV     R2,#(`?<Constant "hal sw1 pressed!\\r\\n">` & 0xff)
   \   00001D   7B..         MOV     R3,#((`?<Constant "hal sw1 pressed!\\r\\n">` >> 8) & 0xff)
   \   00001F   12....       LCALL   ??uart0_puts?relay
    535          #endif
    536              }
    537          
    538              if ( keys & HAL_KEY_SW_2 )
   \                     ??GenericApp_HandleKeys_1:
   \   000022   EE           MOV     A,R6
   \   000023   A2E1         MOV     C,0xE0 /* A   */.1
   \   000025   5072         JNC     ??GenericApp_HandleKeys_2
    539              {
    540                //xiaoyang add
    541          #if _m_debug
    542                uart0_puts("hal sw2 pressed!\r\n",strlen("hal sw2 pressed!\r\n"));
   \   000027                ; Setup parameters for call to function uart0_puts
   \   000027   7C12         MOV     R4,#0x12
   \   000029   7D00         MOV     R5,#0x0
   \   00002B   7A..         MOV     R2,#(`?<Constant "hal sw2 pressed!\\r\\n">` & 0xff)
   \   00002D   7B..         MOV     R3,#((`?<Constant "hal sw2 pressed!\\r\\n">` >> 8) & 0xff)
   \   00002F   12....       LCALL   ?Subroutine0 & 0xFFFF
    543          #endif
    544                HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF );
    545          
    546                // Initiate an End Device Bind Request for the mandatory endpoint
    547                dstAddr.addrMode = Addr16Bit;
   \                     ??CrossCallReturnLabel_0:
   \   000032   12....       LCALL   ?XSTACK_DISP0_8
   \   000035   7402         MOV     A,#0x2
   \   000037   F0           MOVX    @DPTR,A
    548                dstAddr.addr.shortAddr = 0x0000; // Coordinator
   \   000038   85..82       MOV     DPL,?XSP + 0
   \   00003B   85..83       MOV     DPH,?XSP + 1
   \   00003E   E4           CLR     A
   \   00003F   F0           MOVX    @DPTR,A
   \   000040   A3           INC     DPTR
   \   000041   F0           MOVX    @DPTR,A
    549                ZDP_EndDeviceBindReq( &dstAddr, NLME_GetShortAddr(),
    550                                      GenericApp_epDesc.endPoint,
    551                                      GENERICAPP_PROFID,
    552                                      GENERICAPP_MAX_CLUSTERS, (cId_t *)GenericApp_ClusterList,
    553                                      GENERICAPP_MAX_CLUSTERS, (cId_t *)GenericApp_ClusterList,
    554                                      FALSE );
   \   000042                ; Setup parameters for call to function NLME_GetShortAddr
   \   000042   12....       LCALL   ??NLME_GetShortAddr?relay
   \   000045   8A..         MOV     ?V0 + 0,R2
   \   000047   8B..         MOV     ?V0 + 1,R3
   \   000049   AC..         MOV     R4,?V0 + 0
   \   00004B   AD..         MOV     R5,?V0 + 1
   \   00004D                ; Setup parameters for call to function ZDP_EndDeviceBindReq
   \   00004D   75..00       MOV     ?V0 + 0,#0x0
   \   000050   78..         MOV     R0,#?V0 + 0
   \   000052   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000055   75....       MOV     ?V0 + 0,#(GenericApp_ClusterList & 0xff)
   \   000058   75....       MOV     ?V0 + 1,#((GenericApp_ClusterList >> 8) & 0xff)
   \   00005B   78..         MOV     R0,#?V0 + 0
   \   00005D   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000060   75..01       MOV     ?V0 + 0,#0x1
   \   000063   78..         MOV     R0,#?V0 + 0
   \   000065   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000068   75....       MOV     ?V0 + 0,#(GenericApp_ClusterList & 0xff)
   \   00006B   78..         MOV     R0,#?V0 + 0
   \   00006D   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000070   75..01       MOV     ?V0 + 0,#0x1
   \   000073   78..         MOV     R0,#?V0 + 0
   \   000075   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000078   75..04       MOV     ?V0 + 0,#0x4
   \   00007B   75..0F       MOV     ?V0 + 1,#0xf
   \   00007E   78..         MOV     R0,#?V0 + 0
   \   000080   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000083   90....       MOV     DPTR,#GenericApp_epDesc
   \   000086   E0           MOVX    A,@DPTR
   \   000087   F9           MOV     R1,A
   \   000088   7409         MOV     A,#0x9
   \   00008A   12....       LCALL   ?XSTACK_DISP0_8
   \   00008D   AA82         MOV     R2,DPL
   \   00008F   AB83         MOV     R3,DPH
   \   000091   12....       LCALL   ??ZDP_EndDeviceBindReq?relay
   \   000094   7409         MOV     A,#0x9
   \   000096   12....       LCALL   ?DEALLOC_XSTACK8
    555              }
    556              
    557              //µ¼º½°´¼üÏñÏÂ°´
    558              if ( keys & HAL_KEY_SW_3 )
   \                     ??GenericApp_HandleKeys_2:
   \   000099   EE           MOV     A,R6
   \   00009A   A2E4         MOV     C,0xE0 /* A   */.4
   \   00009C   500B         JNC     ??GenericApp_HandleKeys_3
    559              {
    560          #if _m_debug
    561                
    562                char buf[65]="";
                            ^
Warning[Pe177]: variable "buf" was declared but never referenced
    563                uint16 len = 0;
                              ^
Warning[Pe177]: variable "len" was declared but never referenced
    564                uart0_puts("[[hal sw3 pressed\n",strlen("[[hal sw3 pressed\n")+1);
   \   00009E                ; Setup parameters for call to function uart0_puts
   \   00009E   7C13         MOV     R4,#0x13
   \   0000A0   7D00         MOV     R5,#0x0
   \   0000A2   7A..         MOV     R2,#(`?<Constant "[[hal sw3 pressed\\n">` & 0xff)
   \   0000A4   7B..         MOV     R3,#((`?<Constant "[[hal sw3 pressed\\n">` >> 8) & 0xff)
   \   0000A6   12....       LCALL   ??uart0_puts?relay
    565                //len = uart0_getString (buf,64);
    566                //HalUARTRead(0,buf, 64);
    567                //buf[65] = '\0';
    568                //HalUARTWrite(0,buf,strlen(buf));
    569                
    570                //Æô¶¯ÈÎÎñ
    571                //osal_start_timerEx (data_trans_TaskID, 5, 250); //250msºóÖ´ÐÐdata_trans_process
    572          #endif
    573              }
    574          
    575              //µ¼º½°´¼üÏò×ó°´
    576              if ( keys & HAL_KEY_SW_4 )
   \                     ??GenericApp_HandleKeys_3:
   \   0000A9   EE           MOV     A,R6
   \   0000AA   A2E3         MOV     C,0xE0 /* A   */.3
   \   0000AC   5061         JNC     ??GenericApp_HandleKeys_0
    577              {
    578          #if _m_debug
    579                uart0_puts("hal sw4 pressed!\n\r\n",strlen("hal sw4 pressed!\n\r\n"));
   \   0000AE                ; Setup parameters for call to function uart0_puts
   \   0000AE   7C13         MOV     R4,#0x13
   \   0000B0   7D00         MOV     R5,#0x0
   \   0000B2   7A..         MOV     R2,#(`?<Constant "hal sw4 pressed!\\n\\r\\n">` & 0xff)
   \   0000B4   7B..         MOV     R3,#((`?<Constant "hal sw4 pressed!\\n\\r\\n">` >> 8) & 0xff)
   \   0000B6   12....       LCALL   ?Subroutine0 & 0xFFFF
    580          #endif
    581                HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF );
    582          
    583                // Initiate a Match Description Request (Service Discovery)
    584                dstAddr.addrMode = AddrBroadcast;
   \                     ??CrossCallReturnLabel_1:
   \   0000B9   12....       LCALL   ?XSTACK_DISP0_8
   \   0000BC   740F         MOV     A,#0xf
   \   0000BE   F0           MOVX    @DPTR,A
    585                dstAddr.addr.shortAddr = NWK_BROADCAST_SHORTADDR;
   \   0000BF   85..82       MOV     DPL,?XSP + 0
   \   0000C2   85..83       MOV     DPH,?XSP + 1
   \   0000C5   74FF         MOV     A,#-0x1
   \   0000C7   F0           MOVX    @DPTR,A
   \   0000C8   A3           INC     DPTR
   \   0000C9   F0           MOVX    @DPTR,A
    586                ZDP_MatchDescReq( &dstAddr, NWK_BROADCAST_SHORTADDR,
    587                                  GENERICAPP_PROFID,
    588                                  GENERICAPP_MAX_CLUSTERS, (cId_t *)GenericApp_ClusterList,
    589                                  GENERICAPP_MAX_CLUSTERS, (cId_t *)GenericApp_ClusterList,
    590                                  FALSE );
   \   0000CA                ; Setup parameters for call to function ZDP_MatchDescReq
   \   0000CA   75..00       MOV     ?V0 + 0,#0x0
   \   0000CD   78..         MOV     R0,#?V0 + 0
   \   0000CF   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   0000D2   75....       MOV     ?V0 + 0,#(GenericApp_ClusterList & 0xff)
   \   0000D5   75....       MOV     ?V0 + 1,#((GenericApp_ClusterList >> 8) & 0xff)
   \   0000D8   78..         MOV     R0,#?V0 + 0
   \   0000DA   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000DD   75..01       MOV     ?V0 + 0,#0x1
   \   0000E0   78..         MOV     R0,#?V0 + 0
   \   0000E2   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   0000E5   75....       MOV     ?V0 + 0,#(GenericApp_ClusterList & 0xff)
   \   0000E8   78..         MOV     R0,#?V0 + 0
   \   0000EA   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000ED   75..04       MOV     ?V0 + 0,#0x4
   \   0000F0   75..0F       MOV     ?V0 + 1,#0xf
   \   0000F3   78..         MOV     R0,#?V0 + 0
   \   0000F5   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000F8   7901         MOV     R1,#0x1
   \   0000FA   7CFF         MOV     R4,#-0x1
   \   0000FC   7DFF         MOV     R5,#-0x1
   \   0000FE   7408         MOV     A,#0x8
   \   000100   12....       LCALL   ?XSTACK_DISP0_8
   \   000103   AA82         MOV     R2,DPL
   \   000105   AB83         MOV     R3,DPH
   \   000107   12....       LCALL   ??ZDP_MatchDescReq?relay
   \   00010A   7408         MOV     A,#0x8
   \   00010C   12....       LCALL   ?DEALLOC_XSTACK8
    591              }
    592            }
    593          }
   \                     ??GenericApp_HandleKeys_0:
   \   00010F   7409         MOV     A,#0x9
   \   000111   02....       LJMP    ?Subroutine6 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   12....       LCALL   ??uart0_puts?relay
   \   000003                ; Setup parameters for call to function HalLedSet
   \   000003                ; Setup parameters for call to function HalLedSet
   \   000003   7A00         MOV     R2,#0x0
   \   000005   7908         MOV     R1,#0x8
   \   000007   12....       LCALL   ??HalLedSet?relay
   \   00000A   7408         MOV     A,#0x8
   \   00000C   22           RET
    594          
    595          /*********************************************************************
    596           * LOCAL FUNCTIONS
    597           */
    598          
    599          /*********************************************************************
    600           * @fn      GenericApp_MessageMSGCB
    601           *
    602           * @brief   Data message processor callback.  This function processes
    603           *          any incoming data - probably from other devices.  So, based
    604           *          on cluster ID, perform the intended action.
    605           *
    606           * @param   none
    607           *
    608           * @return  none
    609           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    610          void GenericApp_MessageMSGCB( afIncomingMSGPacket_t *pkt )
   \                     GenericApp_MessageMSGCB:
    611          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
    612            switch ( pkt->clusterId )
   \   000005   8A82         MOV     DPL,R2
   \   000007   8B83         MOV     DPH,R3
   \   000009   A3           INC     DPTR
   \   00000A   A3           INC     DPTR
   \   00000B   A3           INC     DPTR
   \   00000C   A3           INC     DPTR
   \   00000D   12....       LCALL   ?Subroutine1 & 0xFFFF
   \                     ??CrossCallReturnLabel_3:
   \   000010   12....       LCALL   ?US_SWITCH_DENSE
   \                     `?<Jumptable for GenericApp_MessageMSGCB>_0`:
   \   000013   0100         DW        1
   \   000015   00           DB        0
   \   000016   ....         DW        ??GenericApp_MessageMSGCB_0
   \   000018   ....         DW        ??GenericApp_MessageMSGCB_1
    613            {
    614              case GENERICAPP_CLUSTERID:
    615                // "the" message
    616          #if defined( LCD_SUPPORTED )
    617                HalLcdWriteScreen( (char*)pkt->cmd.Data, "rcvd" );
   \                     ??GenericApp_MessageMSGCB_1:
   \   00001A                ; Setup parameters for call to function HalLcdWriteScreen
   \   00001A   7C..         MOV     R4,#(`?<Constant "rcvd">` & 0xff)
   \   00001C   7D..         MOV     R5,#((`?<Constant "rcvd">` >> 8) & 0xff)
   \   00001E   EA           MOV     A,R2
   \   00001F   2415         ADD     A,#0x15
   \   000021   F582         MOV     DPL,A
   \   000023   EB           MOV     A,R3
   \   000024   3400         ADDC    A,#0x0
   \   000026   F583         MOV     DPH,A
   \   000028   E0           MOVX    A,@DPTR
   \   000029   FA           MOV     R2,A
   \   00002A   A3           INC     DPTR
   \   00002B   E0           MOVX    A,@DPTR
   \   00002C   FB           MOV     R3,A
   \   00002D   12....       LCALL   ??HalLcdWriteScreen?relay
    618          #elif defined( WIN32 )
    619                WPRINTSTR( pkt->cmd.Data );
    620          #endif
    621                break;
    622            }
    623          }
   \                     ??GenericApp_MessageMSGCB_0:
   \   000030   02....       LJMP    ??Subroutine6_0 & 0xFFFF
    624          
    625          /*********************************************************************
    626           * @fn      GenericApp_SendTheMessage
    627           *
    628           * @brief   Send "the" message.
    629           *
    630           * @param   none
    631           *
    632           * @return  none
    633           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    634          void GenericApp_SendTheMessage( void )
   \                     GenericApp_SendTheMessage:
    635          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 12
   \   000005   74F4         MOV     A,#-0xc
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
    636            char theMessageData[] = "Hello World";
   \   00000A   85..82       MOV     DPL,?XSP + 0
   \   00000D   85..83       MOV     DPH,?XSP + 1
   \   000010   AC82         MOV     R4,DPL
   \   000012   AD83         MOV     R5,DPH
   \   000014   7583..       MOV     DPH,#((`?<Constant "Hello World">` >> 8) & 0xff)
   \   000017   7582..       MOV     DPL,#(`?<Constant "Hello World">` & 0xff)
   \   00001A   740C         MOV     A,#0xc
   \   00001C   12....       LCALL   ?MOVE_LONG8_XDATA_XDATA
    637          
    638            if ( AF_DataRequest( &GenericApp_DstAddr, &GenericApp_epDesc,
    639                                 GENERICAPP_CLUSTERID,
    640                                 (byte)osal_strlen( theMessageData ) + 1,
    641                                 (byte *)&theMessageData,
    642                                 &GenericApp_TransID,
    643                                 AF_DISCV_ROUTE, AF_DEFAULT_RADIUS ) == afStatus_SUCCESS )
   \   00001F                ; Setup parameters for call to function AF_DataRequest
   \   00001F   75..0A       MOV     ?V0 + 0,#0xa
   \   000022   78..         MOV     R0,#?V0 + 0
   \   000024   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000027   75....       MOV     ?V0 + 0,#(GenericApp_TransID & 0xff)
   \   00002A   75....       MOV     ?V0 + 1,#((GenericApp_TransID >> 8) & 0xff)
   \   00002D   78..         MOV     R0,#?V0 + 0
   \   00002F   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000032   7403         MOV     A,#0x3
   \   000034   12....       LCALL   ?XSTACK_DISP0_8
   \   000037   8582..       MOV     ?V0 + 0,DPL
   \   00003A   8583..       MOV     ?V0 + 1,DPH
   \   00003D   78..         MOV     R0,#?V0 + 0
   \   00003F   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000042                ; Setup parameters for call to function osal_strlen
   \   000042   7405         MOV     A,#0x5
   \   000044   12....       LCALL   ?XSTACK_DISP0_8
   \   000047   AA82         MOV     R2,DPL
   \   000049   AB83         MOV     R3,DPH
   \   00004B   12....       LCALL   ??osal_strlen?relay
   \   00004E   EA           MOV     A,R2
   \   00004F   F8           MOV     R0,A
   \   000050   7401         MOV     A,#0x1
   \   000052   28           ADD     A,R0
   \   000053   F5..         MOV     ?V0 + 0,A
   \   000055   E4           CLR     A
   \   000056   3400         ADDC    A,#0x0
   \   000058   F5..         MOV     ?V0 + 1,A
   \   00005A   78..         MOV     R0,#?V0 + 0
   \   00005C   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00005F   75..01       MOV     ?V0 + 0,#0x1
   \   000062   75..00       MOV     ?V0 + 1,#0x0
   \   000065   78..         MOV     R0,#?V0 + 0
   \   000067   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00006A   7920         MOV     R1,#0x20
   \   00006C   7C..         MOV     R4,#(GenericApp_epDesc & 0xff)
   \   00006E   7D..         MOV     R5,#((GenericApp_epDesc >> 8) & 0xff)
   \   000070   7A..         MOV     R2,#(GenericApp_DstAddr & 0xff)
   \   000072   7B..         MOV     R3,#((GenericApp_DstAddr >> 8) & 0xff)
   \   000074   12....       LCALL   ??AF_DataRequest?relay
   \   000077   7409         MOV     A,#0x9
   \   000079   12....       LCALL   ?DEALLOC_XSTACK8
    644            {
    645              // Successfully requested to be sent.
    646            }
    647            else
    648            {
    649              // Error occurred in request to send.
    650            }
    651          }
   \   00007C   740C         MOV     A,#0xc
   \   00007E   02....       LJMP    ?Subroutine6 & 0xFFFF
    652          
    653          /*********************************************************************
    654          *********************************************************************/
    655          /*********************************************************************
    656           * TYPEDEFS
    657           */
    658          #ifndef UART0_GET_STR
    659          #define UART0_GET_STR   1
    660          typedef struct
    661          {
    662            uint8 *rxBuf;
    663            uint8 rxHead;
    664            uint8 rxTail;
    665            uint8 rxMax;
    666            uint8 rxCnt;
    667            uint8 rxTick;
    668            uint8 rxHigh;
    669          
    670            uint8 *txBuf;
    671          #if HAL_UART_BIG_TX_BUF
    672            uint16 txHead;
    673            uint16 txTail;
    674            uint16 txMax;
    675            uint16 txCnt;
    676          #else
    677            uint8 txHead;
    678            uint8 txTail;
    679            uint8 txMax;
    680            uint8 txCnt;
    681          #endif
    682            uint8 txTick;
    683          
    684            uint8 flag;
    685          
    686            halUARTCBack_t rxCB;
    687          } uartCfg_t;
    688          
    689          #if ( HAL_UART_DEBUG )
    690            #define HAL_UART_ASSERT( expr)        HAL_ASSERT( expr )
    691          #else
    692            #define HAL_UART_ASSERT( expr )
    693          #endif
    694          
    695          #define UART_CFG_U1F  0x80  // USART1 flag bit.
    696          #define UART_CFG_DMA  0x40  // Port is using DMA.
    697          #define UART_CFG_FLW  0x20  // Port is using flow control.
    698          #define UART_CFG_SP4  0x10
    699          #define UART_CFG_SP3  0x08
    700          #define UART_CFG_SP2  0x04
    701          #define UART_CFG_RXF  0x02  // Rx flow is disabled.
    702          #define UART_CFG_TXF  0x01  // Tx is in process.
    703          
    704          extern uartCfg_t *cfg0;
    705          /*xiaoyang added*/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    706          uint16 uart0_getString(char* buf,uint16 max_len)
   \                     uart0_getString:
    707          {
   \   000000   74F3         MOV     A,#-0xd
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 13
   \   000005                ; Auto size: 0
   \   000005   EC           MOV     A,R4
   \   000006   FE           MOV     R6,A
   \   000007   ED           MOV     A,R5
   \   000008   FF           MOV     R7,A
    708            //uint16 HalUARTRead( uint8 port, uint8 *buf, uint16 len );
    709            uartCfg_t *cfg = NULL;
    710            uint16 cnt = 0;
   \   000009   7800         MOV     R0,#0x0
   \   00000B   7900         MOV     R1,#0x0
    711          
    712            cfg = cfg0;
   \   00000D   90....       MOV     DPTR,#cfg0
   \   000010   E0           MOVX    A,@DPTR
   \   000011   FC           MOV     R4,A
   \   000012   A3           INC     DPTR
   \   000013   E0           MOVX    A,@DPTR
   \   000014   FD           MOV     R5,A
   \   000015   800D         SJMP    ??uart0_getString_0
    713            HAL_UART_ASSERT( cfg );
    714            while ( (cfg->rxTail != cfg->rxHead) &&(cnt < max_len) )
    715            {
    716              *buf = cfg->rxBuf[cfg->rxTail];
    717              if ( cfg->rxTail == cfg->rxMax )
    718              {
    719                cfg->rxTail = 0;
    720              }
    721              else
    722              {
    723                cfg->rxTail++;
    724              }
    725              //xiaoyang add
    726              if(*buf == '\0'){
    727                  buf++;
    728                  *buf ='\0' ;
    729                  return cnt;
    730              }
    731              buf++;
   \                     ??uart0_getString_1:
   \   000017   A3           INC     DPTR
   \   000018   AA82         MOV     R2,DPL
   \   00001A   AB83         MOV     R3,DPH
    732              cnt++;
   \   00001C   E8           MOV     A,R0
   \   00001D   2401         ADD     A,#0x1
   \   00001F   08           INC     R0
   \   000020   E9           MOV     A,R1
   \   000021   3400         ADDC    A,#0x0
   \   000023   F9           MOV     R1,A
   \                     ??uart0_getString_0:
   \   000024   8C82         MOV     DPL,R4
   \   000026   8D83         MOV     DPH,R5
   \   000028   A3           INC     DPTR
   \   000029   A3           INC     DPTR
   \   00002A   A3           INC     DPTR
   \   00002B   12....       LCALL   ?Subroutine2 & 0xFFFF
   \                     ??CrossCallReturnLabel_4:
   \   00002E   E0           MOVX    A,@DPTR
   \   00002F   65..         XRL     A,?V0 + 0
   \   000031   6060         JZ      ??uart0_getString_2
   \   000033   C3           CLR     C
   \   000034   E8           MOV     A,R0
   \   000035   9E           SUBB    A,R6
   \   000036   E9           MOV     A,R1
   \   000037   9F           SUBB    A,R7
   \   000038   5059         JNC     ??uart0_getString_2
   \   00003A   EC           MOV     A,R4
   \   00003B   2403         ADD     A,#0x3
   \   00003D   F5..         MOV     ?V0 + 0,A
   \   00003F   ED           MOV     A,R5
   \   000040   3400         ADDC    A,#0x0
   \   000042   F5..         MOV     ?V0 + 1,A
   \   000044   85..82       MOV     DPL,?V0 + 0
   \   000047   F583         MOV     DPH,A
   \   000049   E0           MOVX    A,@DPTR
   \   00004A   F5..         MOV     ?V0 + 2,A
   \   00004C   8C82         MOV     DPL,R4
   \   00004E   8D83         MOV     DPH,R5
   \   000050   E0           MOVX    A,@DPTR
   \   000051   25..         ADD     A,?V0 + 2
   \   000053   F5..         MOV     ?V0 + 4,A
   \   000055   A3           INC     DPTR
   \   000056   E0           MOVX    A,@DPTR
   \   000057   3400         ADDC    A,#0x0
   \   000059   85..82       MOV     DPL,?V0 + 4
   \   00005C   F583         MOV     DPH,A
   \   00005E   E0           MOVX    A,@DPTR
   \   00005F   8A82         MOV     DPL,R2
   \   000061   8B83         MOV     DPH,R3
   \   000063   F0           MOVX    @DPTR,A
   \   000064   85..82       MOV     DPL,?V0 + 0
   \   000067   85..83       MOV     DPH,?V0 + 1
   \   00006A   12....       LCALL   ?Subroutine2 & 0xFFFF
   \                     ??CrossCallReturnLabel_5:
   \   00006D   A3           INC     DPTR
   \   00006E   A3           INC     DPTR
   \   00006F   E0           MOVX    A,@DPTR
   \   000070   65..         XRL     A,?V0 + 0
   \   000072   700A         JNZ     ??uart0_getString_3
   \   000074   E4           CLR     A
   \   000075   8C82         MOV     DPL,R4
   \   000077   8D83         MOV     DPH,R5
   \   000079   A3           INC     DPTR
   \   00007A   A3           INC     DPTR
   \   00007B   A3           INC     DPTR
   \   00007C   8009         SJMP    ??uart0_getString_4
   \                     ??uart0_getString_3:
   \   00007E   8C82         MOV     DPL,R4
   \   000080   8D83         MOV     DPH,R5
   \   000082   A3           INC     DPTR
   \   000083   A3           INC     DPTR
   \   000084   A3           INC     DPTR
   \   000085   E0           MOVX    A,@DPTR
   \   000086   04           INC     A
   \                     ??uart0_getString_4:
   \   000087   F0           MOVX    @DPTR,A
   \   000088   8A82         MOV     DPL,R2
   \   00008A   8B83         MOV     DPH,R3
   \   00008C   E0           MOVX    A,@DPTR
   \   00008D   7088         JNZ     ??uart0_getString_1
   \   00008F   E4           CLR     A
   \   000090   A3           INC     DPTR
   \   000091   8011         SJMP    ??uart0_getString_5
    733            }
    734          
    735          #if HAL_UART_DMA
    736            #if HAL_UART_ISR
    737            if ( cfg->flag & UART_CFG_DMA )
    738            #endif
    739            {
    740              /* If there is no flow control on a DMA-driven UART, the Rx Head & Tail
    741               * pointers must be reset to zero after every read in order to preserve the
    742               * full length of the Rx buffer. This implies that every Read must read all
    743               * of the Rx bytes available, or the pointers will not be reset and the
    744               * next incoming packet may not fit in the Rx buffer space remaining - thus
    745               * the end portion of the incoming packet that does not fit would be lost.
    746               */
    747              if ( !(cfg->flag & UART_CFG_FLW) )
   \                     ??uart0_getString_2:
   \   000093   EC           MOV     A,R4
   \   000094   240F         ADD     A,#0xf
   \   000096   F582         MOV     DPL,A
   \   000098   ED           MOV     A,R5
   \   000099   3400         ADDC    A,#0x0
   \   00009B   F583         MOV     DPH,A
   \   00009D   E0           MOVX    A,@DPTR
   \   00009E   A2E5         MOV     C,0xE0 /* A   */.5
   \   0000A0   4003         JC      ??uart0_getString_6
    748              {
    749                // This is a trick to trigger the DMA abort and restart logic in pollDMA.
    750                cfg->flag |= UART_CFG_RXF;
   \   0000A2   D2E1         SETB    0xE0 /* A   */.1
   \                     ??uart0_getString_5:
   \   0000A4   F0           MOVX    @DPTR,A
    751              }
    752            }
    753          #endif
    754          
    755            return cnt;
   \                     ??uart0_getString_6:
   \   0000A5   E8           MOV     A,R0
   \   0000A6   FA           MOV     R2,A
   \   0000A7   E9           MOV     A,R1
   \   0000A8   FB           MOV     R3,A
   \   0000A9                REQUIRE ?Subroutine7
   \   0000A9                ; // Fall through to label ?Subroutine7
    756          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine7:
   \   000000   7F05         MOV     R7,#0x5
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   E0           MOVX    A,@DPTR
   \   000001   F5..         MOV     ?V0 + 0,A
   \   000003   8C82         MOV     DPL,R4
   \   000005   8D83         MOV     DPH,R5
   \   000007   A3           INC     DPTR
   \   000008   A3           INC     DPTR
   \   000009   22           RET
    757          #endif
    758          
    759          //------------------------------------------------------------------------------
    760          //xiaoyang add, data_trans task
    761          //------------------------------------------------------------------------------

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    762          void data_trans_Init( uint8 task_id ) //ÈÎÎñ³õÊ¼»¯º¯Êý
   \                     data_trans_Init:
    763          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    764              data_trans_TaskID = task_id;//ÓÃdata_trans_TaskIDÈ«¾Ö±äÁ¿¼Ç×¡×Ô¼ºµÄÈÎÎñºÅ£¬
   \   000004   E9           MOV     A,R1
   \   000005   90....       MOV     DPTR,#data_trans_TaskID
   \   000008   F0           MOVX    @DPTR,A
    765              SPIMgr_RegisterTaskID( task_id );//×¢²á¸ÃÈÎÎñÎª´®¿ÚÈÎÎñ£¬ÆäÊµ¾ÍÊÇApp_TaskID = data_trans_TaskID;
   \   000009                ; Setup parameters for call to function SPIMgr_RegisterTaskID
   \   000009   12....       LCALL   ??SPIMgr_RegisterTaskID?relay
    766          }
   \   00000C   02....       LJMP    ?Subroutine4 & 0xFFFF
    767          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    768          uint16 data_trans_process( uint8 task_id, uint16 events ) //ÈÎÎñ´¦Àíº¯Êý
   \                     data_trans_process:
    769          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
    770            /*
    771            char buf[33]="";
    772            //ÔÚ´®¿Úµ÷ÊÔÖúÊÖÖÐÄã·¢Ê²Ã´¾ÍÊÕµ½Ê²Ã´
    773            HalUARTRead(SPI_MGR_DEFAULT_PORT,buf,32 );//¶Á´®¿ÚÊý¾Ýµ½buf
    774            HalUARTWrite(0,buf,32);//°ÑbufÍ¨¹ý´®¿Ú·¢³öÈ¥
    775          #if defined(ZAPP_P1)
    776            SPIMgr_AppFlowControl(SPI_MGR_ZAPP_RX_READY);//»Ö¸´Á÷£¬²»È»²»ÄÜ½ÓÊÕÐÂÊý¾Ý
    777          #endif
    778            return 0;   
    779            */
    780          }
                 ^
Warning[Pe940]: missing return statement at end of non-void function
          "data_trans_process"
   \   000000   02....       LJMP    ?BRET
    781          
    782          //------------------------------------------------------------------------------
    783          // xiaoyang add @2011-5-25
    784          //------------------------------------------------------------------------------
    785          
    786          /******************************************************************************
    787           * CONSTANTS
    788           */
    789          //BUFFER buffer;
    790          
    791          /******************************************************************************
    792          * @fn  initUART
    793          *
    794          * @brief
    795          *      Initializes components for the UART application example.
    796          *
    797          * Parameters:
    798          *
    799          * @param  void
    800          *
    801          * @return void
    802          *
    803          ******************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    804          void UART_SETUP(char uart,int baudRate,char options)  
   \                     UART_SETUP:
    805          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
    806              if ((options) & FLOW_CONTROL_ENABLE){      
   \   000005   EC           MOV     A,R4
   \   000006   A2E6         MOV     C,0xE0 /* A   */.6
   \   000008   E5F1         MOV     A,0xf1
   \   00000A   5010         JNC     ??UART_SETUP_0
    807                  if(PERCFG & 0x01){ /* Alt 2        */
   \   00000C   A2E0         MOV     C,0xE0 /* A   */.0
   \   00000E   5007         JNC     ??UART_SETUP_1
    808                     P1SEL |= 0x3C;                    
   \   000010   43F43C       ORL     0xf4,#0x3c
   \                     ??UART_SETUP_2:
   \   000013   E5F4         MOV     A,0xf4
   \   000015   8013         SJMP    ??UART_SETUP_3
    809                  } else {           /* Alt 1        */
    810                     P0SEL |= 0x3C;                    
   \                     ??UART_SETUP_1:
   \   000017   43F33C       ORL     0xf3,#0x3c
   \   00001A   800C         SJMP    ??UART_SETUP_4
    811                  }                                                                         
    812              }                                          
    813              else{                    
    814                  if(PERCFG & 0x01){ /* Alt 2        */
   \                     ??UART_SETUP_0:
   \   00001C   A2E0         MOV     C,0xE0 /* A   */.0
   \   00001E   5005         JNC     ??UART_SETUP_5
    815                     P1SEL |= 0x30;                    
   \   000020   43F430       ORL     0xf4,#0x30
   \   000023   80EE         SJMP    ??UART_SETUP_2
    816                  } else {           /* Alt 1        */
    817                     P0SEL |= 0x0C;                    
   \                     ??UART_SETUP_5:
   \   000025   43F30C       ORL     0xf3,#0xc
   \                     ??UART_SETUP_4:
   \   000028   E5F3         MOV     A,0xf3
    818                  }                                                                                                    
    819              }   
    820              
    821              U0GCR = BAUD_E((baudRate), CLKSPD);
                             ^
Warning[Pa084]: pointless integer comparison with an out of range value

      U0GCR = BAUD_E((baudRate), CLKSPD);
              ^
"D:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Samples\GenericApp\Source\GenericApp.c",821  Warning[Pa084]: 
          pointless integer comparison with an out of range value

      U0GCR = BAUD_E((baudRate), CLKSPD);
              ^
"D:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Samples\GenericApp\Source\GenericApp.c",821  Warning[Pa084]: 
          pointless integer comparison with an out of range value

      U0GCR = BAUD_E((baudRate), CLKSPD);
              ^
"D:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Samples\GenericApp\Source\GenericApp.c",821  Warning[Pa084]: 
          pointless integer comparison with an out of range value

      U0GCR = BAUD_E((baudRate), CLKSPD);
              ^
"D:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Samples\GenericApp\Source\GenericApp.c",821  Warning[Pa084]: 
          pointless integer comparison with an out of range value

      U0GCR = BAUD_E((baudRate), CLKSPD);
              ^
"D:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Samples\GenericApp\Source\GenericApp.c",821  Warning[Pa084]: 
          pointless integer comparison with an out of range value

      U0GCR = BAUD_E((baudRate), CLKSPD);
              ^
"D:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Samples\GenericApp\Source\GenericApp.c",821  Warning[Pa084]: 
          pointless integer comparison with an out of range value
   \                     ??UART_SETUP_3:
   \   00002A   7460         MOV     A,#0x60
   \   00002C   6A           XRL     A,R2
   \   00002D   7003         JNZ     ??UART_SETUP_6
   \   00002F   7409         MOV     A,#0x9
   \   000031   6B           XRL     A,R3
   \                     ??UART_SETUP_6:
   \   000032   700C         JNZ     ??UART_SETUP_7
   \   000034   E5C6         MOV     A,0xc6
   \   000036   A2E0         MOV     C,0xE0 /* A   */.0
   \   000038   E4           CLR     A
   \   000039   92E0         MOV     0xE0 /* A   */.0,C
   \   00003B   2406         ADD     A,#0x6
   \   00003D   02....       LJMP    ??UART_SETUP_8 & 0xFFFF
   \                     ??UART_SETUP_7:
   \   000040   74C0         MOV     A,#-0x40
   \   000042   6A           XRL     A,R2
   \   000043   7003         JNZ     ??UART_SETUP_9
   \   000045   7412         MOV     A,#0x12
   \   000047   6B           XRL     A,R3
   \                     ??UART_SETUP_9:
   \   000048   700C         JNZ     ??UART_SETUP_10
   \   00004A   E5C6         MOV     A,0xc6
   \   00004C   A2E0         MOV     C,0xE0 /* A   */.0
   \   00004E   E4           CLR     A
   \   00004F   92E0         MOV     0xE0 /* A   */.0,C
   \   000051   2407         ADD     A,#0x7
   \   000053   02....       LJMP    ??UART_SETUP_11 & 0xFFFF
   \                     ??UART_SETUP_10:
   \   000056   7480         MOV     A,#-0x80
   \   000058   6A           XRL     A,R2
   \   000059   7003         JNZ     ??UART_SETUP_12
   \   00005B   7425         MOV     A,#0x25
   \   00005D   6B           XRL     A,R3
   \                     ??UART_SETUP_12:
   \   00005E   700C         JNZ     ??UART_SETUP_13
   \   000060   E5C6         MOV     A,0xc6
   \   000062   A2E0         MOV     C,0xE0 /* A   */.0
   \   000064   E4           CLR     A
   \   000065   92E0         MOV     0xE0 /* A   */.0,C
   \   000067   2408         ADD     A,#0x8
   \   000069   02....       LJMP    ??UART_SETUP_14 & 0xFFFF
   \                     ??UART_SETUP_13:
   \   00006C   7440         MOV     A,#0x40
   \   00006E   6A           XRL     A,R2
   \   00006F   7003         JNZ     ??UART_SETUP_15
   \   000071   7438         MOV     A,#0x38
   \   000073   6B           XRL     A,R3
   \                     ??UART_SETUP_15:
   \   000074   700C         JNZ     ??UART_SETUP_16
   \   000076   E5C6         MOV     A,0xc6
   \   000078   A2E0         MOV     C,0xE0 /* A   */.0
   \   00007A   E4           CLR     A
   \   00007B   92E0         MOV     0xE0 /* A   */.0,C
   \   00007D   2408         ADD     A,#0x8
   \   00007F   02....       LJMP    ??UART_SETUP_17 & 0xFFFF
   \                     ??UART_SETUP_16:
   \   000082   EA           MOV     A,R2
   \   000083   7003         JNZ     ??UART_SETUP_18
   \   000085   744B         MOV     A,#0x4b
   \   000087   6B           XRL     A,R3
   \                     ??UART_SETUP_18:
   \   000088   700C         JNZ     ??UART_SETUP_19
   \   00008A   E5C6         MOV     A,0xc6
   \   00008C   A2E0         MOV     C,0xE0 /* A   */.0
   \   00008E   E4           CLR     A
   \   00008F   92E0         MOV     0xE0 /* A   */.0,C
   \   000091   2409         ADD     A,#0x9
   \   000093   02....       LJMP    ??UART_SETUP_20 & 0xFFFF
   \                     ??UART_SETUP_19:
   \   000096   7480         MOV     A,#-0x80
   \   000098   6A           XRL     A,R2
   \   000099   7003         JNZ     ??UART_SETUP_21
   \   00009B   7470         MOV     A,#0x70
   \   00009D   6B           XRL     A,R3
   \                     ??UART_SETUP_21:
   \   00009E   700C         JNZ     ??UART_SETUP_22
   \   0000A0   E5C6         MOV     A,0xc6
   \   0000A2   A2E0         MOV     C,0xE0 /* A   */.0
   \   0000A4   E4           CLR     A
   \   0000A5   92E0         MOV     0xE0 /* A   */.0,C
   \   0000A7   2409         ADD     A,#0x9
   \   0000A9   02....       LJMP    ??UART_SETUP_23 & 0xFFFF
   \                     ??UART_SETUP_22:
   \   0000AC   12....       LCALL   ?Subroutine3 & 0xFFFF
   \                     ??CrossCallReturnLabel_6:
   \   0000AF   12....       LCALL   ?L_EQ_X
   \   0000B2   700C         JNZ     ??UART_SETUP_24
   \   0000B4   E5C6         MOV     A,0xc6
   \   0000B6   A2E0         MOV     C,0xE0 /* A   */.0
   \   0000B8   E4           CLR     A
   \   0000B9   92E0         MOV     0xE0 /* A   */.0,C
   \   0000BB   240A         ADD     A,#0xa
   \   0000BD   02....       LJMP    ??UART_SETUP_25 & 0xFFFF
   \                     ??UART_SETUP_24:
   \   0000C0   EB           MOV     A,R3
   \   0000C1   33           RLC     A
   \   0000C2   95E0         SUBB    A,0xE0 /* A   */
   \   0000C4   90....       MOV     DPTR,#__Constant_e100
   \   0000C7   78..         MOV     R0,#?V0 + 0
   \   0000C9   12....       LCALL   ?L_EQ_X
   \   0000CC   700C         JNZ     ??UART_SETUP_26
   \   0000CE   E5C6         MOV     A,0xc6
   \   0000D0   A2E0         MOV     C,0xE0 /* A   */.0
   \   0000D2   E4           CLR     A
   \   0000D3   92E0         MOV     0xE0 /* A   */.0,C
   \   0000D5   240A         ADD     A,#0xa
   \   0000D7   02....       LJMP    ??UART_SETUP_27 & 0xFFFF
   \                     ??UART_SETUP_26:
   \   0000DA   EB           MOV     A,R3
   \   0000DB   33           RLC     A
   \   0000DC   95E0         SUBB    A,0xE0 /* A   */
   \   0000DE   90....       MOV     DPTR,#__Constant_12c00
   \   0000E1   78..         MOV     R0,#?V0 + 0
   \   0000E3   12....       LCALL   ?L_EQ_X
   \   0000E6   700B         JNZ     ??UART_SETUP_28
   \   0000E8   E5C6         MOV     A,0xc6
   \   0000EA   A2E0         MOV     C,0xE0 /* A   */.0
   \   0000EC   E4           CLR     A
   \   0000ED   92E0         MOV     0xE0 /* A   */.0,C
   \   0000EF   240B         ADD     A,#0xb
   \   0000F1   806E         SJMP    ??UART_SETUP_29
   \                     ??UART_SETUP_28:
   \   0000F3   EB           MOV     A,R3
   \   0000F4   33           RLC     A
   \   0000F5   95E0         SUBB    A,0xE0 /* A   */
   \   0000F7   90....       MOV     DPTR,#__Constant_1c200
   \   0000FA   78..         MOV     R0,#?V0 + 0
   \   0000FC   12....       LCALL   ?L_EQ_X
   \   0000FF   700B         JNZ     ??UART_SETUP_30
   \   000101   E5C6         MOV     A,0xc6
   \   000103   A2E0         MOV     C,0xE0 /* A   */.0
   \   000105   E4           CLR     A
   \   000106   92E0         MOV     0xE0 /* A   */.0,C
   \   000108   240B         ADD     A,#0xb
   \   00010A   8053         SJMP    ??UART_SETUP_31
   \                     ??UART_SETUP_30:
   \   00010C   EB           MOV     A,R3
   \   00010D   33           RLC     A
   \   00010E   95E0         SUBB    A,0xE0 /* A   */
   \   000110   90....       MOV     DPTR,#__Constant_25800
   \   000113   78..         MOV     R0,#?V0 + 0
   \   000115   12....       LCALL   ?L_EQ_X
   \   000118   700B         JNZ     ??UART_SETUP_32
   \   00011A   E5C6         MOV     A,0xc6
   \   00011C   A2E0         MOV     C,0xE0 /* A   */.0
   \   00011E   E4           CLR     A
   \   00011F   92E0         MOV     0xE0 /* A   */.0,C
   \   000121   240C         ADD     A,#0xc
   \   000123   8038         SJMP    ??UART_SETUP_33
   \                     ??UART_SETUP_32:
   \   000125   EB           MOV     A,R3
   \   000126   33           RLC     A
   \   000127   95E0         SUBB    A,0xE0 /* A   */
   \   000129   90....       MOV     DPTR,#__Constant_38400
   \   00012C   78..         MOV     R0,#?V0 + 0
   \   00012E   12....       LCALL   ?L_EQ_X
   \   000131   700B         JNZ     ??UART_SETUP_34
   \   000133   E5C6         MOV     A,0xc6
   \   000135   A2E0         MOV     C,0xE0 /* A   */.0
   \   000137   E4           CLR     A
   \   000138   92E0         MOV     0xE0 /* A   */.0,C
   \   00013A   240C         ADD     A,#0xc
   \   00013C   801D         SJMP    ??UART_SETUP_35
   \                     ??UART_SETUP_34:
   \   00013E   EB           MOV     A,R3
   \   00013F   33           RLC     A
   \   000140   95E0         SUBB    A,0xE0 /* A   */
   \   000142   90....       MOV     DPTR,#__Constant_4b000
   \   000145   78..         MOV     R0,#?V0 + 0
   \   000147   12....       LCALL   ?L_EQ_X
   \   00014A   700C         JNZ     ??UART_SETUP_36
   \   00014C   E5C6         MOV     A,0xc6
   \   00014E   A2E0         MOV     C,0xE0 /* A   */.0
   \   000150   E4           CLR     A
   \   000151   92E0         MOV     0xE0 /* A   */.0,C
   \   000153   240D         ADD     A,#0xd
   \   000155   FD           MOV     R5,A
   \   000156   8002         SJMP    ??UART_SETUP_37
   \                     ??UART_SETUP_36:
   \   000158   7D00         MOV     R5,#0x0
   \                     ??UART_SETUP_37:
   \   00015A   ED           MOV     A,R5
   \                     ??UART_SETUP_35:
   \   00015B   FE           MOV     R6,A
   \   00015C   EE           MOV     A,R6
   \                     ??UART_SETUP_33:
   \   00015D   FD           MOV     R5,A
   \   00015E   ED           MOV     A,R5
   \                     ??UART_SETUP_31:
   \   00015F   FE           MOV     R6,A
   \   000160   EE           MOV     A,R6
   \                     ??UART_SETUP_29:
   \   000161   FD           MOV     R5,A
   \   000162   ED           MOV     A,R5
   \                     ??UART_SETUP_27:
   \   000163   FE           MOV     R6,A
   \   000164   EE           MOV     A,R6
   \                     ??UART_SETUP_25:
   \   000165   FD           MOV     R5,A
   \   000166   ED           MOV     A,R5
   \                     ??UART_SETUP_23:
   \   000167   FE           MOV     R6,A
   \   000168   EE           MOV     A,R6
   \                     ??UART_SETUP_20:
   \   000169   FD           MOV     R5,A
   \   00016A   ED           MOV     A,R5
   \                     ??UART_SETUP_17:
   \   00016B   FE           MOV     R6,A
   \   00016C   EE           MOV     A,R6
   \                     ??UART_SETUP_14:
   \   00016D   FD           MOV     R5,A
   \   00016E   ED           MOV     A,R5
   \                     ??UART_SETUP_11:
   \   00016F   FE           MOV     R6,A
   \   000170   EE           MOV     A,R6
   \                     ??UART_SETUP_8:
   \   000171   FD           MOV     R5,A
   \   000172   8DC5         MOV     0xc5,R5
    822              U0BAUD = BAUD_M(baudRate);
                              ^
Warning[Pa084]: pointless integer comparison with an out of range value

      U0BAUD = BAUD_M(baudRate);
               ^
"D:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Samples\GenericApp\Source\GenericApp.c",822  Warning[Pa084]: 
          pointless integer comparison with an out of range value

      U0BAUD = BAUD_M(baudRate);
               ^
"D:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Samples\GenericApp\Source\GenericApp.c",822  Warning[Pa084]: 
          pointless integer comparison with an out of range value

      U0BAUD = BAUD_M(baudRate);
               ^
"D:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Samples\GenericApp\Source\GenericApp.c",822  Warning[Pa084]: 
          pointless integer comparison with an out of range value

      U0BAUD = BAUD_M(baudRate);
               ^
"D:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Samples\GenericApp\Source\GenericApp.c",822  Warning[Pa084]: 
          pointless integer comparison with an out of range value

      U0BAUD = BAUD_M(baudRate);
               ^
"D:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Samples\GenericApp\Source\GenericApp.c",822  Warning[Pa084]: 
          pointless integer comparison with an out of range value

      U0BAUD = BAUD_M(baudRate);
               ^
"D:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Samples\GenericApp\Source\GenericApp.c",822  Warning[Pa084]: 
          pointless integer comparison with an out of range value
   \   000174   7460         MOV     A,#0x60
   \   000176   6A           XRL     A,R2
   \   000177   7003         JNZ     ??UART_SETUP_38
   \   000179   7409         MOV     A,#0x9
   \   00017B   6B           XRL     A,R3
   \                     ??UART_SETUP_38:
   \   00017C   7005         JNZ     ??UART_SETUP_39
   \   00017E   7A3B         MOV     R2,#0x3b
   \   000180   02....       LJMP    ??UART_SETUP_40 & 0xFFFF
   \                     ??UART_SETUP_39:
   \   000183   74C0         MOV     A,#-0x40
   \   000185   6A           XRL     A,R2
   \   000186   7003         JNZ     ??UART_SETUP_41
   \   000188   7412         MOV     A,#0x12
   \   00018A   6B           XRL     A,R3
   \                     ??UART_SETUP_41:
   \   00018B   7005         JNZ     ??UART_SETUP_42
   \   00018D   7B3B         MOV     R3,#0x3b
   \   00018F   02....       LJMP    ??UART_SETUP_43 & 0xFFFF
   \                     ??UART_SETUP_42:
   \   000192   7480         MOV     A,#-0x80
   \   000194   6A           XRL     A,R2
   \   000195   7003         JNZ     ??UART_SETUP_44
   \   000197   7425         MOV     A,#0x25
   \   000199   6B           XRL     A,R3
   \                     ??UART_SETUP_44:
   \   00019A   7005         JNZ     ??UART_SETUP_45
   \   00019C   7A3B         MOV     R2,#0x3b
   \   00019E   02....       LJMP    ??UART_SETUP_46 & 0xFFFF
   \                     ??UART_SETUP_45:
   \   0001A1   7440         MOV     A,#0x40
   \   0001A3   6A           XRL     A,R2
   \   0001A4   7003         JNZ     ??UART_SETUP_47
   \   0001A6   7438         MOV     A,#0x38
   \   0001A8   6B           XRL     A,R3
   \                     ??UART_SETUP_47:
   \   0001A9   7005         JNZ     ??UART_SETUP_48
   \   0001AB   7BD8         MOV     R3,#-0x28
   \   0001AD   02....       LJMP    ??UART_SETUP_49 & 0xFFFF
   \                     ??UART_SETUP_48:
   \   0001B0   EA           MOV     A,R2
   \   0001B1   7003         JNZ     ??UART_SETUP_50
   \   0001B3   744B         MOV     A,#0x4b
   \   0001B5   6B           XRL     A,R3
   \                     ??UART_SETUP_50:
   \   0001B6   7005         JNZ     ??UART_SETUP_51
   \   0001B8   7A3B         MOV     R2,#0x3b
   \   0001BA   02....       LJMP    ??UART_SETUP_52 & 0xFFFF
   \                     ??UART_SETUP_51:
   \   0001BD   7480         MOV     A,#-0x80
   \   0001BF   6A           XRL     A,R2
   \   0001C0   7003         JNZ     ??UART_SETUP_53
   \   0001C2   7470         MOV     A,#0x70
   \   0001C4   6B           XRL     A,R3
   \                     ??UART_SETUP_53:
   \   0001C5   7004         JNZ     ??UART_SETUP_54
   \   0001C7   7BD8         MOV     R3,#-0x28
   \   0001C9   8070         SJMP    ??UART_SETUP_55
   \                     ??UART_SETUP_54:
   \   0001CB   12....       LCALL   ?Subroutine3 & 0xFFFF
   \                     ??CrossCallReturnLabel_7:
   \   0001CE   12....       LCALL   ?L_EQ_X
   \   0001D1   7004         JNZ     ??UART_SETUP_56
   \   0001D3   7A3B         MOV     R2,#0x3b
   \   0001D5   8062         SJMP    ??UART_SETUP_57
   \                     ??UART_SETUP_56:
   \   0001D7   90....       MOV     DPTR,#__Constant_e100
   \   0001DA   78..         MOV     R0,#?V0 + 0
   \   0001DC   12....       LCALL   ?L_EQ_X
   \   0001DF   7004         JNZ     ??UART_SETUP_58
   \   0001E1   7BD8         MOV     R3,#-0x28
   \   0001E3   8052         SJMP    ??UART_SETUP_59
   \                     ??UART_SETUP_58:
   \   0001E5   90....       MOV     DPTR,#__Constant_12c00
   \   0001E8   78..         MOV     R0,#?V0 + 0
   \   0001EA   12....       LCALL   ?L_EQ_X
   \   0001ED   7004         JNZ     ??UART_SETUP_60
   \   0001EF   7A3B         MOV     R2,#0x3b
   \   0001F1   8042         SJMP    ??UART_SETUP_61
   \                     ??UART_SETUP_60:
   \   0001F3   90....       MOV     DPTR,#__Constant_1c200
   \   0001F6   78..         MOV     R0,#?V0 + 0
   \   0001F8   12....       LCALL   ?L_EQ_X
   \   0001FB   7004         JNZ     ??UART_SETUP_62
   \   0001FD   7BD8         MOV     R3,#-0x28
   \   0001FF   8032         SJMP    ??UART_SETUP_63
   \                     ??UART_SETUP_62:
   \   000201   90....       MOV     DPTR,#__Constant_25800
   \   000204   78..         MOV     R0,#?V0 + 0
   \   000206   12....       LCALL   ?L_EQ_X
   \   000209   7004         JNZ     ??UART_SETUP_64
   \   00020B   7A3B         MOV     R2,#0x3b
   \   00020D   8022         SJMP    ??UART_SETUP_65
   \                     ??UART_SETUP_64:
   \   00020F   90....       MOV     DPTR,#__Constant_38400
   \   000212   78..         MOV     R0,#?V0 + 0
   \   000214   12....       LCALL   ?L_EQ_X
   \   000217   7004         JNZ     ??UART_SETUP_66
   \   000219   7BD8         MOV     R3,#-0x28
   \   00021B   8012         SJMP    ??UART_SETUP_67
   \                     ??UART_SETUP_66:
   \   00021D   90....       MOV     DPTR,#__Constant_4b000
   \   000220   78..         MOV     R0,#?V0 + 0
   \   000222   12....       LCALL   ?L_EQ_X
   \   000225   7004         JNZ     ??UART_SETUP_68
   \   000227   7A3B         MOV     R2,#0x3b
   \   000229   8002         SJMP    ??UART_SETUP_69
   \                     ??UART_SETUP_68:
   \   00022B   7A00         MOV     R2,#0x0
   \                     ??UART_SETUP_69:
   \   00022D   EA           MOV     A,R2
   \   00022E   FB           MOV     R3,A
   \                     ??UART_SETUP_67:
   \   00022F   EB           MOV     A,R3
   \   000230   FA           MOV     R2,A
   \                     ??UART_SETUP_65:
   \   000231   EA           MOV     A,R2
   \   000232   FB           MOV     R3,A
   \                     ??UART_SETUP_63:
   \   000233   EB           MOV     A,R3
   \   000234   FA           MOV     R2,A
   \                     ??UART_SETUP_61:
   \   000235   EA           MOV     A,R2
   \   000236   FB           MOV     R3,A
   \                     ??UART_SETUP_59:
   \   000237   EB           MOV     A,R3
   \   000238   FA           MOV     R2,A
   \                     ??UART_SETUP_57:
   \   000239   EA           MOV     A,R2
   \   00023A   FB           MOV     R3,A
   \                     ??UART_SETUP_55:
   \   00023B   EB           MOV     A,R3
   \   00023C   FA           MOV     R2,A
   \                     ??UART_SETUP_52:
   \   00023D   EA           MOV     A,R2
   \   00023E   FB           MOV     R3,A
   \                     ??UART_SETUP_49:
   \   00023F   EB           MOV     A,R3
   \   000240   FA           MOV     R2,A
   \                     ??UART_SETUP_46:
   \   000241   EA           MOV     A,R2
   \   000242   FB           MOV     R3,A
   \                     ??UART_SETUP_43:
   \   000243   EB           MOV     A,R3
   \   000244   FA           MOV     R2,A
   \                     ??UART_SETUP_40:
   \   000245   8AC2         MOV     0xc2,R2
    823              U0UCR = ((options) | 0x80);
   \   000247   7480         MOV     A,#-0x80
   \   000249   4C           ORL     A,R4
   \   00024A   F5C4         MOV     0xc4,A
    824              U0CSR = 0x80;
   \   00024C   758680       MOV     0x86,#-0x80
    825                                       
    826              if((options) & TRANSFER_MSB_FIRST){        
   \   00024F   EC           MOV     A,R4
   \   000250   A2E7         MOV     C,0xE0 /* A   */.7
   \   000252   5003         JNC     ??UART_SETUP_70
    827                 U0GCR |= 0x20;                   
   \   000254   43C520       ORL     0xc5,#0x20
    828              }
    829          }
   \                     ??UART_SETUP_70:
   \   000257   02....       LJMP    ?Subroutine5 & 0xFFFF
   \   00025A                REQUIRE U0CSR
   \   00025A                REQUIRE U0BAUD
   \   00025A                REQUIRE U0UCR
   \   00025A                REQUIRE U0GCR
   \   00025A                REQUIRE CLKCON
   \   00025A                REQUIRE PERCFG
   \   00025A                REQUIRE P0SEL
   \   00025A                REQUIRE P1SEL

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine3:
   \   000000   8A..         MOV     ?V0 + 0,R2
   \   000002   EB           MOV     A,R3
   \   000003   F5..         MOV     ?V0 + 1,A
   \   000005   33           RLC     A
   \   000006   95E0         SUBB    A,0xE0 /* A   */
   \   000008   F5..         MOV     ?V0 + 2,A
   \   00000A   F5..         MOV     ?V0 + 3,A
   \   00000C   90....       MOV     DPTR,#__Constant_9600
   \   00000F   78..         MOV     R0,#?V0 + 0
   \   000011   22           RET
    830          /*
    831          void initUART(void)
    832          {
    833             // Setup for UART0
    834             IO_PER_LOC_USART0_AT_PORT0_PIN2345();
    835          
    836             //ÉèÖÃ²¨ÌØÂÊºÍ´«ÊäÄ£Ê½
    837             UART_SETUP(0, 9600, HIGH_STOP);
    838             
    839             UTX0IF = 1;
    840          }
    841          */
    842          // Global interrupt enables
    843          #define INT_GLOBAL_ENABLE(on) EA=(!!on)
    844          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    845          void UART0ISRopen(void)
   \                     UART0ISRopen:
    846          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
    847            U0UCR|=0x80;
   \   000000   43C480       ORL     0xc4,#0x80
    848            IEN0 |= 0x04;//¿ª´®¿Ú½ÓÊÕÖÐ¶Ï 'URX0IE = 1',
   \   000003   D2AA         SETB    0xa8.2
    849            INT_GLOBAL_ENABLE(TRUE);
   \   000005   D2AF         SETB    0xa8.7
    850          }
   \   000007   02....       LJMP    ?BRET
   \   00000A                REQUIRE _A_IEN0
   \   00000A                REQUIRE U0UCR
    851          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    852          void initUART(void)
   \                     initUART:
    853          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    854             // Setup for UART0
    855            // IO_PER_LOC_UART0_AT_PORT0_PIN2345();
    856             IO_PER_LOC_USART0_AT_PORT0_PIN2345();
   \   000004   53F1FE       ANL     0xf1,#0xfe
    857             //SET_MAIN_CLOCK_SOURCE(CRYSTAL);
    858             UART_SETUP(0, 9600, HIGH_STOP);
   \   000007                ; Setup parameters for call to function UART_SETUP
   \   000007   7C02         MOV     R4,#0x2
   \   000009   7A80         MOV     R2,#-0x80
   \   00000B   7B25         MOV     R3,#0x25
   \   00000D   7900         MOV     R1,#0x0
   \   00000F   12....       LCALL   ??UART_SETUP?relay
    859             U0CSR = 0xC5;//ÔÊÐí½ÓÊÕ
   \   000012   7586C5       MOV     0x86,#-0x3b
    860             UTX0IF=1;
   \   000015   D2E9         SETB    0xe8.1
    861             URX0IF=1;
   \   000017   D28B         SETB    0x88.3
    862             
    863             UART0ISRopen();
   \   000019                ; Setup parameters for call to function UART0ISRopen
   \   000019   12....       LCALL   ??UART0ISRopen?relay
    864          }
   \   00001C   02....       LJMP    ?Subroutine4 & 0xFFFF
   \   00001F                REQUIRE U0CSR
   \   00001F                REQUIRE _A_TCON
   \   00001F                REQUIRE _A_IRCON2
   \   00001F                REQUIRE PERCFG
    865          
    866          #pragma vector=URX0_VECTOR                //URX0_VECTOR

   \                                 In  segment NEAR_CODE, align 1, keep-with-next
    867          __interrupt void URX0_IRQ(void){
                                               ^
Warning[Ta028]: Banked interrupt functions not allowed, __near_func is assumed
   \                     URX0_IRQ:
   \   000000   C0E0         PUSH    A
   \   000002                ; Saved register size: 2
   \   000002                ; Auto size: 0
    868              char c;
    869              //while (!URX0IF);
    870              c = U0DBUF;
   \   000002   E5C1         MOV     A,0xc1
    871              //uart0_putc(c);
    872              URX0IF=0;
   \   000004   C28B         CLR     0x88.3
    873          }
   \   000006   D0E0         POP     A
   \   000008   32           RETI
   \   000009                REQUIRE _A_TCON
   \   000009                REQUIRE U0DBUF
    874          
    875          //-----------------------------------------------------------------------------
    876          // sned str or char via uart0
    877          //-----------------------------------------------------------------------------
    878          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    879          int uart0_putc(int c)
   \                     uart0_putc:
    880          {
   \   000000                ; Saved register size: 1
   \   000000                ; Auto size: 0
    881             if (c == '\n')  {
   \   000000   740A         MOV     A,#0xa
   \   000002   6A           XRL     A,R2
   \   000003   7001         JNZ     ??uart0_putc_0
   \   000005   EB           MOV     A,R3
   \                     ??uart0_putc_0:
   \   000006   7009         JNZ     ??uart0_putc_1
    882                while (!UTX0IF);
   \                     ??uart0_putc_2:
   \   000008   A2E9         MOV     C,0xe8.1
   \   00000A   50FC         JNC     ??uart0_putc_2
    883                UTX0IF = 0;
   \   00000C   C2E9         CLR     0xe8.1
    884                U0DBUF = 0x0d;       //output CR 
   \   00000E   75C10D       MOV     0xc1,#0xd
    885             }
    886          
    887             while (!UTX0IF);
   \                     ??uart0_putc_1:
   \   000011   A2E9         MOV     C,0xe8.1
   \   000013   50FC         JNC     ??uart0_putc_1
    888             UTX0IF = 0;
   \   000015   C2E9         CLR     0xe8.1
    889             return (U0DBUF = c);
   \   000017   8AC1         MOV     0xc1,R2
   \   000019   7B00         MOV     R3,#0x0
   \   00001B   02....       LJMP    ?BRET
   \   00001E                REQUIRE U0DBUF
   \   00001E                REQUIRE _A_IRCON2
    890          }
    891          
    892          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    893          void uart0_puts(char* str,int len)
   \                     uart0_puts:
    894          {
   \   000000   74F3         MOV     A,#-0xd
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 13
   \   000005                ; Auto size: 0
   \   000005   8A..         MOV     ?V0 + 2,R2
   \   000007   8B..         MOV     ?V0 + 3,R3
   \   000009   8C..         MOV     ?V0 + 0,R4
   \   00000B   8D..         MOV     ?V0 + 1,R5
    895              int i = 0;
    896              if(str == NULL)
   \   00000D   EA           MOV     A,R2
   \   00000E   7001         JNZ     ??uart0_puts_0
   \   000010   EB           MOV     A,R3
   \                     ??uart0_puts_0:
   \   000011   602D         JZ      ??uart0_puts_1
    897                  return ;
    898              for(i = 0; i < len; i++)
   \   000013   7E00         MOV     R6,#0x0
   \   000015   7F00         MOV     R7,#0x0
   \   000017   8019         SJMP    ??uart0_puts_2
    899              {
    900                  uart0_putc(*(str+i));
   \                     ??uart0_puts_3:
   \   000019                ; Setup parameters for call to function uart0_putc
   \   000019   E5..         MOV     A,?V0 + 2
   \   00001B   2E           ADD     A,R6
   \   00001C   F582         MOV     DPL,A
   \   00001E   E5..         MOV     A,?V0 + 3
   \   000020   3F           ADDC    A,R7
   \   000021   F583         MOV     DPH,A
   \   000023   E0           MOVX    A,@DPTR
   \   000024   FA           MOV     R2,A
   \   000025   7B00         MOV     R3,#0x0
   \   000027   12....       LCALL   ??uart0_putc?relay
    901              }
   \   00002A   EE           MOV     A,R6
   \   00002B   2401         ADD     A,#0x1
   \   00002D   0E           INC     R6
   \   00002E   EF           MOV     A,R7
   \   00002F   3400         ADDC    A,#0x0
   \   000031   FF           MOV     R7,A
   \                     ??uart0_puts_2:
   \   000032   C3           CLR     C
   \   000033   EE           MOV     A,R6
   \   000034   95..         SUBB    A,?V0 + 0
   \   000036   EF           MOV     A,R7
   \   000037   95..         SUBB    A,?V0 + 1
   \   000039   A2D2         MOV     C,0xD0 /* PSW */.2
   \   00003B   65D0         XRL     A,PSW
   \   00003D   33           RLC     A
   \   00003E   40D9         JC      ??uart0_puts_3
   \                     ??uart0_puts_1:
   \   000040   02....       LJMP    ?Subroutine7 & 0xFFFF
    902          }

   \                                 In  segment INTVEC, offset 0x13, root
   \                     `??URX0_IRQ??INTVEC 19`:
   \   000013   02....       LJMP       (URX0_IRQ)

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for <Constant "GenericApp">>`:
   \   000000   47656E65     DB "GenericApp"
   \            72696341
   \            707000  

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for <Constant "hal sw1 pressed!\\`:
   \   000000   68616C20     DB "hal sw1 pressed!\015\012"
   \            73773120
   \            70726573
   \            73656421
   \            0D0A00  

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for <Constant "hal sw2 pressed!\\`:
   \   000000   68616C20     DB "hal sw2 pressed!\015\012"
   \            73773220
   \            70726573
   \            73656421
   \            0D0A00  

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for <Constant "[[hal sw3 pressed`:
   \   000000   5B5B6861     DB "[[hal sw3 pressed\012"
   \            6C207377
   \            33207072
   \            65737365
   \            640A00  

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for <Constant "hal sw4 pressed!\\`:
   \   000000   68616C20     DB "hal sw4 pressed!\012\015\012"
   \            73773420
   \            70726573
   \            73656421
   \            0A0D0A00

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for <Constant "rcvd">>`:
   \   000000   72637664     DB "rcvd"
   \            00      

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for <Constant "Hello World">>`:
   \   000000   48656C6C     DB "Hello World"
   \            6F20576F
   \            726C6400

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for GenericApp_ClusterList>`:
   \   000000   0100         DW 1

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for GenericApp_SimpleDesc>`:
   \   000000   0A           DB 10
   \   000001   040F0100     DW 3844, 1
   \   000005   0001         DB 0, 1
   \   000007   ....         DW GenericApp_ClusterList
   \   000009   01           DB 1
   \   00000A   ....         DW GenericApp_ClusterList

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for __Constant_9600>`:
   \   000000   00960000     DD 38400

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for __Constant_e100>`:
   \   000000   00E10000     DD 57600

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for __Constant_12c00>`:
   \   000000   002C0100     DD 76800

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for __Constant_1c200>`:
   \   000000   00C20100     DD 115200

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for __Constant_25800>`:
   \   000000   00580200     DD 153600

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for __Constant_38400>`:
   \   000000   00840300     DD 230400

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for __Constant_4b000>`:
   \   000000   00B00400     DD 307200

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??GenericApp_Init?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    GenericApp_Init

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??GenericApp_ProcessEvent?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    GenericApp_ProcessEvent

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??GenericApp_ProcessZDOMsgs?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    GenericApp_ProcessZDOMsgs

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??GenericApp_HandleKeys?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    GenericApp_HandleKeys

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??GenericApp_MessageMSGCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    GenericApp_MessageMSGCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??GenericApp_SendTheMessage?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    GenericApp_SendTheMessage

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??uart0_getString?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    uart0_getString

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??data_trans_Init?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    data_trans_Init

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??data_trans_process?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    data_trans_process

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??UART_SETUP?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    UART_SETUP

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??UART0ISRopen?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    UART0ISRopen

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??initUART?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    initUART

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??uart0_putc?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    uart0_putc

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??uart0_puts?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    uart0_puts

   \                                 In  segment XDATA_I, align 1, keep-with-next
   \                     `?<Constant "GenericApp">`:
   \   000000                DS 11
   \   00000B                REQUIRE `?<Initializer for <Constant "GenericApp">>`
   \   00000B                REQUIRE __INIT_XDATA_I

   \                                 In  segment XDATA_I, align 1, keep-with-next
   \                     `?<Constant "hal sw1 pressed!\\r\\n">`:
   \   000000                DS 19
   \   000013                REQUIRE `?<Initializer for <Constant "hal sw1 pressed!\\`
   \   000013                REQUIRE __INIT_XDATA_I

   \                                 In  segment XDATA_I, align 1, keep-with-next
   \                     `?<Constant "hal sw2 pressed!\\r\\n">`:
   \   000000                DS 19
   \   000013                REQUIRE `?<Initializer for <Constant "hal sw2 pressed!\\`
   \   000013                REQUIRE __INIT_XDATA_I

   \                                 In  segment XDATA_I, align 1, keep-with-next
   \                     `?<Constant "[[hal sw3 pressed\\n">`:
   \   000000                DS 19
   \   000013                REQUIRE `?<Initializer for <Constant "[[hal sw3 pressed`
   \   000013                REQUIRE __INIT_XDATA_I

   \                                 In  segment XDATA_I, align 1, keep-with-next
   \                     `?<Constant "hal sw4 pressed!\\n\\r\\n">`:
   \   000000                DS 20
   \   000014                REQUIRE `?<Initializer for <Constant "hal sw4 pressed!\\`
   \   000014                REQUIRE __INIT_XDATA_I

   \                                 In  segment XDATA_I, align 1, keep-with-next
   \                     `?<Constant "rcvd">`:
   \   000000                DS 5
   \   000005                REQUIRE `?<Initializer for <Constant "rcvd">>`
   \   000005                REQUIRE __INIT_XDATA_I

   \                                 In  segment XDATA_I, align 1, keep-with-next
   \                     `?<Constant "Hello World">`:
   \   000000                DS 12
   \   00000C                REQUIRE `?<Initializer for <Constant "Hello World">>`
   \   00000C                REQUIRE __INIT_XDATA_I

   \                                 In  segment XDATA_I, align 1, keep-with-next
   \                     __Constant_9600:
   \   000000                DS 4
   \   000004                REQUIRE `?<Initializer for __Constant_9600>`
   \   000004                REQUIRE __INIT_XDATA_I

   \                                 In  segment XDATA_I, align 1, keep-with-next
   \                     __Constant_e100:
   \   000000                DS 4
   \   000004                REQUIRE `?<Initializer for __Constant_e100>`
   \   000004                REQUIRE __INIT_XDATA_I

   \                                 In  segment XDATA_I, align 1, keep-with-next
   \                     __Constant_12c00:
   \   000000                DS 4
   \   000004                REQUIRE `?<Initializer for __Constant_12c00>`
   \   000004                REQUIRE __INIT_XDATA_I

   \                                 In  segment XDATA_I, align 1, keep-with-next
   \                     __Constant_1c200:
   \   000000                DS 4
   \   000004                REQUIRE `?<Initializer for __Constant_1c200>`
   \   000004                REQUIRE __INIT_XDATA_I

   \                                 In  segment XDATA_I, align 1, keep-with-next
   \                     __Constant_25800:
   \   000000                DS 4
   \   000004                REQUIRE `?<Initializer for __Constant_25800>`
   \   000004                REQUIRE __INIT_XDATA_I

   \                                 In  segment XDATA_I, align 1, keep-with-next
   \                     __Constant_38400:
   \   000000                DS 4
   \   000004                REQUIRE `?<Initializer for __Constant_38400>`
   \   000004                REQUIRE __INIT_XDATA_I

   \                                 In  segment XDATA_I, align 1, keep-with-next
   \                     __Constant_4b000:
   \   000000                DS 4
   \   000004                REQUIRE `?<Initializer for __Constant_4b000>`
   \   000004                REQUIRE __INIT_XDATA_I

   Maximum stack usage in bytes:

     Function                       ISTACK PSTACK XSTACK
     --------                       ------ ------ ------
     GenericApp_HandleKeys              1      0     40
       -> uart0_puts                    0      0     38
       -> uart0_puts                    0      0     38
       -> HalLedSet                     0      0     38
       -> NLME_GetShortAddr             0      0     38
       -> ZDP_EndDeviceBindReq          0      0     56
       -> uart0_puts                    0      0     38
       -> uart0_puts                    0      0     38
       -> HalLedSet                     0      0     38
       -> ZDP_MatchDescReq              0      0     54
     GenericApp_Init                    2      0      0
       -> afRegister                    4      0      0
       -> RegisterForKeys               4      0      0
       -> HalLcdWriteString             4      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
       -> initUART                      4      0      0
     GenericApp_MessageMSGCB            0      0     22
       -> HalLcdWriteScreen             0      0     20
     GenericApp_ProcessEvent            0      0     12
       -> osal_msg_receive              0      0     24
       -> osal_start_timerEx            0      0     24
       -> osal_msg_deallocate           0      0     24
       -> osal_msg_receive              0      0     24
       -> GenericApp_ProcessZDOMsgs     0      0     24
       -> GenericApp_HandleKeys         0      0     24
       -> GenericApp_MessageMSGCB       0      0     24
       -> GenericApp_SendTheMessage     0      0     24
       -> osal_start_timerEx            0      0     24
     GenericApp_ProcessZDOMsgs          0      0     22
       -> HalLedSet                     0      0     20
       -> HalLedSet                     0      0     20
       -> ZDO_ParseEPListRsp            0      0     20
       -> HalLedSet                     0      0     20
       -> osal_mem_free                 0      0     20
     GenericApp_SendTheMessage          2      0     43
       -> osal_strlen                   0      0     54
       -> AF_DataRequest                0      0     62
     UART0ISRopen                       0      0      0
     UART_SETUP                         0      0     12
     URX0_IRQ                           2      0      0
     data_trans_Init                    2      0      0
       -> SPIMgr_RegisterTaskID         4      0      0
     data_trans_process                 0      0      0
     initUART                           2      0      0
       -> UART_SETUP                    4      0      0
       -> UART0ISRopen                  4      0      0
     uart0_getString                    1      0     13
     uart0_putc                         1      0     13
     uart0_puts                         0      0     32
       -> uart0_putc                    0      0     26


   Segment part sizes:

     Function/Label                 Bytes
     --------------                 -----
     U0CSR                             1
     _A_TCON                           1
     _A_IEN0                           1
     U0DBUF                            1
     U0BAUD                            1
     U0UCR                             1
     U0GCR                             1
     CLKCON                            1
     _A_IRCON2                         1
     PERCFG                            1
     P0SEL                             1
     P1SEL                             1
     GenericApp_ClusterList            2
     GenericApp_SimpleDesc            12
     GenericApp_epDesc                 6
     GenericApp_TaskID                 1
     GenericApp_NwkState               1
     GenericApp_TransID                1
     GenericApp_DstAddr                4
     data_trans_TaskID                 1
     GenericApp_Init                 116
     ?Subroutine4                      7
     GenericApp_ProcessEvent         206
     ?Subroutine5                      5
     GenericApp_ProcessZDOMsgs       152
     ?Subroutine6                      8
     ?Subroutine1                     10
     GenericApp_HandleKeys           276
     ?Subroutine0                     13
     GenericApp_MessageMSGCB          51
     GenericApp_SendTheMessage       129
     uart0_getString                 169
     ?Subroutine7                      5
     ?Subroutine2                     10
     data_trans_Init                  15
     data_trans_process                3
     UART_SETUP                      602
     ?Subroutine3                     18
     UART0ISRopen                     10
     initUART                         31
     URX0_IRQ                          9
     uart0_putc                       30
     uart0_puts                       67
     ??URX0_IRQ??INTVEC 19             3
     ?<Initializer for <Constant "GenericApp">>
                                      11
     ?<Initializer for <Constant "hal sw1 pressed!\
                                      19
     ?<Initializer for <Constant "hal sw2 pressed!\
                                      19
     ?<Initializer for <Constant "[[hal sw3 pressed
                                      19
     ?<Initializer for <Constant "hal sw4 pressed!\
                                      20
     ?<Initializer for <Constant "rcvd">>
                                       5
     ?<Initializer for <Constant "Hello World">>
                                      12
     ?<Initializer for GenericApp_ClusterList>
                                       2
     ?<Initializer for GenericApp_SimpleDesc>
                                      12
     ?<Initializer for __Constant_9600>
                                       4
     ?<Initializer for __Constant_e100>
                                       4
     ?<Initializer for __Constant_12c00>
                                       4
     ?<Initializer for __Constant_1c200>
                                       4
     ?<Initializer for __Constant_25800>
                                       4
     ?<Initializer for __Constant_38400>
                                       4
     ?<Initializer for __Constant_4b000>
                                       4
     ??GenericApp_Init?relay           6
     ??GenericApp_ProcessEvent?relay
                                       6
     ??GenericApp_ProcessZDOMsgs?relay
                                       6
     ??GenericApp_HandleKeys?relay     6
     ??GenericApp_MessageMSGCB?relay
                                       6
     ??GenericApp_SendTheMessage?relay
                                       6
     ??uart0_getString?relay           6
     ??data_trans_Init?relay           6
     ??data_trans_process?relay        6
     ??UART_SETUP?relay                6
     ??UART0ISRopen?relay              6
     ??initUART?relay                  6
     ??uart0_putc?relay                6
     ??uart0_puts?relay                6
     ?<Constant "GenericApp">         11
     ?<Constant "hal sw1 pressed!\r\n">
                                      19
     ?<Constant "hal sw2 pressed!\r\n">
                                      19
     ?<Constant "[[hal sw3 pressed\n">
                                      19
     ?<Constant "hal sw4 pressed!\n\r\n">
                                      20
     ?<Constant "rcvd">                5
     ?<Constant "Hello World">        12
     __Constant_9600                   4
     __Constant_e100                   4
     __Constant_12c00                  4
     __Constant_1c200                  4
     __Constant_25800                  4
     __Constant_38400                  4
     __Constant_4b000                  4

 
 1 933 bytes in segment BANKED_CODE
    84 bytes in segment BANK_RELAYS
     3 bytes in segment INTVEC
     9 bytes in segment NEAR_CODE
    12 bytes in segment SFR_AN
   147 bytes in segment XDATA_I
   147 bytes in segment XDATA_ID
    14 bytes in segment XDATA_Z
 
 2 145 bytes of CODE  memory (+ 31 bytes shared)
     0 bytes of DATA  memory (+ 12 bytes shared)
   133 bytes of XDATA memory (+ 28 bytes shared)

Errors: none
Warnings: 19
